<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JVM之字节码技术 | aYuのblog</title><meta name="keywords" content="Java,JVM"><meta name="author" content="aYu"><meta name="copyright" content="aYu"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="字节码技术 1. 类文件结构一个简单的HelloWorld.java 12345public class HelloWorld &amp;#123;    public static void main(String[] args) &amp;#123;        System.out.println(&quot;hello world&quot;);    &amp;#125;&amp;#125;  执行javac -pa">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM之字节码技术">
<meta property="og:url" content="http://www.ayu.link/2022/05/03/JVM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/index.html">
<meta property="og:site_name" content="aYuのblog">
<meta property="og:description" content="字节码技术 1. 类文件结构一个简单的HelloWorld.java 12345public class HelloWorld &amp;#123;    public static void main(String[] args) &amp;#123;        System.out.println(&quot;hello world&quot;);    &amp;#125;&amp;#125;  执行javac -pa">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://www.ayu.link/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/1.jpg">
<meta property="article:published_time" content="2022-05-03T13:35:21.000Z">
<meta property="article:modified_time" content="2022-05-03T13:56:00.676Z">
<meta property="article:author" content="aYu">
<meta property="article:tag" content="Java,JVM">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.ayu.link/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/1.jpg"><link rel="shortcut icon" href="/img/head.png"><link rel="canonical" href="http://www.ayu.link/2022/05/03/JVM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JVM之字节码技术',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-03 21:56:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/static-butterfly/dist/css/index.min.css"><link rel="stylesheet" href="/css/custom@1.0.4.css"><link rel="stylesheet" href="/css/background.css"><link rel="stylesheet" href="/css/color.css"><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.css"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="aYuのblog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/head.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/1.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">aYuのblog</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JVM之字节码技术</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-03T13:35:21.000Z" title="发表于 2022-05-03 21:35:21">2022-05-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-03T13:56:00.676Z" title="更新于 2022-05-03 21:56:00">2022-05-03</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JVM之字节码技术"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="字节码技术"><a href="#字节码技术" class="headerlink" title="字节码技术"></a>字节码技术</h1><p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/JVM%E6%9E%84%E9%80%A0.png" alt="JVM构造"></p>
<h2 id="1-类文件结构"><a href="#1-类文件结构" class="headerlink" title="1. 类文件结构"></a>1. 类文件结构</h2><p>一个简单的HelloWorld.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行<code>javac -parameters -d . HellowWorld.java</code>编译为 HelloWorld.class 后是这个样子的:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0000000</span> ca fe ba be <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">34</span> <span class="number">00</span> <span class="number">23</span> <span class="number">0</span>a <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">15</span> <span class="number">09</span> </span><br><span class="line"><span class="number">0000020</span> <span class="number">00</span> <span class="number">16</span> <span class="number">00</span> <span class="number">17</span> <span class="number">08</span> <span class="number">00</span> <span class="number">18</span> <span class="number">0</span>a <span class="number">00</span> <span class="number">19</span> <span class="number">00</span> <span class="number">1</span>a <span class="number">07</span> <span class="number">00</span> <span class="number">1</span>b <span class="number">07</span> </span><br><span class="line"><span class="number">0000040</span> <span class="number">00</span> <span class="number">1</span>c <span class="number">01</span> <span class="number">00</span> <span class="number">06</span> <span class="number">3</span>c <span class="number">69</span> <span class="number">6</span>e <span class="number">69</span> <span class="number">74</span> <span class="number">3</span>e <span class="number">01</span> <span class="number">00</span> <span class="number">03</span> <span class="number">28</span> <span class="number">29</span> </span><br><span class="line"><span class="number">0000060</span> <span class="number">56</span> <span class="number">01</span> <span class="number">00</span> <span class="number">04</span> <span class="number">43</span> <span class="number">6</span>f <span class="number">64</span> <span class="number">65</span> <span class="number">01</span> <span class="number">00</span> <span class="number">0</span>f <span class="number">4</span>c <span class="number">69</span> <span class="number">6</span>e <span class="number">65</span> <span class="number">4</span>e </span><br><span class="line"><span class="number">0000100</span> <span class="number">75</span> <span class="number">6</span>d <span class="number">62</span> <span class="number">65</span> <span class="number">72</span> <span class="number">54</span> <span class="number">61</span> <span class="number">62</span> <span class="number">6</span>c <span class="number">65</span> <span class="number">01</span> <span class="number">00</span> <span class="number">12</span> <span class="number">4</span>c <span class="number">6</span>f <span class="number">63</span> </span><br><span class="line"><span class="number">0000120</span> <span class="number">61</span> <span class="number">6</span>c <span class="number">56</span> <span class="number">61</span> <span class="number">72</span> <span class="number">69</span> <span class="number">61</span> <span class="number">62</span> <span class="number">6</span>c <span class="number">65</span> <span class="number">54</span> <span class="number">61</span> <span class="number">62</span> <span class="number">6</span>c <span class="number">65</span> <span class="number">01</span> </span><br><span class="line"><span class="number">0000140</span> <span class="number">00</span> <span class="number">04</span> <span class="number">74</span> <span class="number">68</span> <span class="number">69</span> <span class="number">73</span> <span class="number">01</span> <span class="number">00</span> <span class="number">1</span>d <span class="number">4</span>c <span class="number">63</span> <span class="number">6</span>e <span class="number">2</span>f <span class="number">69</span> <span class="number">74</span> <span class="number">63</span> </span><br><span class="line"><span class="number">0000160</span> <span class="number">61</span> <span class="number">73</span> <span class="number">74</span> <span class="number">2</span>f <span class="number">6</span>a <span class="number">76</span> <span class="number">6</span>d <span class="number">2</span>f <span class="number">74</span> <span class="number">35</span> <span class="number">2</span>f <span class="number">48</span> <span class="number">65</span> <span class="number">6</span>c <span class="number">6</span>c <span class="number">6</span>f </span><br><span class="line"><span class="number">0000200</span> <span class="number">57</span> <span class="number">6</span>f <span class="number">72</span> <span class="number">6</span>c <span class="number">64</span> <span class="number">3</span>b <span class="number">01</span> <span class="number">00</span> <span class="number">04</span> <span class="number">6</span>d <span class="number">61</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">01</span> <span class="number">00</span> <span class="number">16</span> </span><br><span class="line"><span class="number">0000220</span> <span class="number">28</span> <span class="number">5</span>b <span class="number">4</span>c <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2</span>f <span class="number">6</span>c <span class="number">61</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">2</span>f <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> </span><br><span class="line"><span class="number">0000240</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">3</span>b <span class="number">29</span> <span class="number">56</span> <span class="number">01</span> <span class="number">00</span> <span class="number">04</span> <span class="number">61</span> <span class="number">72</span> <span class="number">67</span> <span class="number">73</span> <span class="number">01</span> <span class="number">00</span> <span class="number">13</span> </span><br><span class="line"><span class="number">0000260</span> <span class="number">5</span>b <span class="number">4</span>c <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2</span>f <span class="number">6</span>c <span class="number">61</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">2</span>f <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">69</span> </span><br><span class="line"><span class="number">0000300</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">3</span>b <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> <span class="number">4</span>d <span class="number">65</span> <span class="number">74</span> <span class="number">68</span> <span class="number">6</span>f <span class="number">64</span> <span class="number">50</span> <span class="number">61</span> <span class="number">72</span> <span class="number">61</span> </span><br><span class="line"><span class="number">0000320</span> <span class="number">6</span>d <span class="number">65</span> <span class="number">74</span> <span class="number">65</span> <span class="number">72</span> <span class="number">73</span> <span class="number">01</span> <span class="number">00</span> <span class="number">0</span>a <span class="number">53</span> <span class="number">6</span>f <span class="number">75</span> <span class="number">72</span> <span class="number">63</span> <span class="number">65</span> <span class="number">46</span> </span><br><span class="line"><span class="number">0000340</span> <span class="number">69</span> <span class="number">6</span>c <span class="number">65</span> <span class="number">01</span> <span class="number">00</span> <span class="number">0</span>f <span class="number">48</span> <span class="number">65</span> <span class="number">6</span>c <span class="number">6</span>c <span class="number">6</span>f <span class="number">57</span> <span class="number">6</span>f <span class="number">72</span> <span class="number">6</span>c <span class="number">64</span></span><br><span class="line"><span class="number">0000360</span> <span class="number">2</span>e <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">0</span>c <span class="number">00</span> <span class="number">07</span> <span class="number">00</span> <span class="number">08</span> <span class="number">07</span> <span class="number">00</span> <span class="number">1</span>d <span class="number">0</span>c <span class="number">00</span> <span class="number">1</span>e </span><br><span class="line"><span class="number">0000400</span> <span class="number">00</span> <span class="number">1</span>f <span class="number">01</span> <span class="number">00</span> <span class="number">0</span>b <span class="number">68</span> <span class="number">65</span> <span class="number">6</span>c <span class="number">6</span>c <span class="number">6</span>f <span class="number">20</span> <span class="number">77</span> <span class="number">6</span>f <span class="number">72</span> <span class="number">6</span>c <span class="number">64</span> </span><br><span class="line"><span class="number">0000420</span> <span class="number">07</span> <span class="number">00</span> <span class="number">20</span> <span class="number">0</span>c <span class="number">00</span> <span class="number">21</span> <span class="number">00</span> <span class="number">22</span> <span class="number">01</span> <span class="number">00</span> <span class="number">1</span>b <span class="number">63</span> <span class="number">6</span>e <span class="number">2</span>f <span class="number">69</span> <span class="number">74</span> </span><br><span class="line"><span class="number">0000440</span> <span class="number">63</span> <span class="number">61</span> <span class="number">73</span> <span class="number">74</span> <span class="number">2</span>f <span class="number">6</span>a <span class="number">76</span> <span class="number">6</span>d <span class="number">2</span>f <span class="number">74</span> <span class="number">35</span> <span class="number">2</span>f <span class="number">48</span> <span class="number">65</span> <span class="number">6</span>c <span class="number">6</span>c </span><br><span class="line"><span class="number">0000460</span> <span class="number">6</span>f <span class="number">57</span> <span class="number">6</span>f <span class="number">72</span> <span class="number">6</span>c <span class="number">64</span> <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2</span>f <span class="number">6</span>c <span class="number">61</span> </span><br><span class="line"><span class="number">0000500</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">2</span>f <span class="number">4</span>f <span class="number">62</span> <span class="number">6</span>a <span class="number">65</span> <span class="number">63</span> <span class="number">74</span> <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> </span><br><span class="line"><span class="number">0000520</span> <span class="number">2</span>f <span class="number">6</span>c <span class="number">61</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">2</span>f <span class="number">53</span> <span class="number">79</span> <span class="number">73</span> <span class="number">74</span> <span class="number">65</span> <span class="number">6</span>d <span class="number">01</span> <span class="number">00</span> <span class="number">03</span> <span class="number">6</span>f </span><br><span class="line"><span class="number">0000540</span> <span class="number">75</span> <span class="number">74</span> <span class="number">01</span> <span class="number">00</span> <span class="number">15</span> <span class="number">4</span>c <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2</span>f <span class="number">69</span> <span class="number">6</span>f <span class="number">2</span>f <span class="number">50</span> <span class="number">72</span> </span><br><span class="line"><span class="number">0000560</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">65</span> <span class="number">61</span> <span class="number">6</span>d <span class="number">3</span>b <span class="number">01</span> <span class="number">00</span> <span class="number">13</span> <span class="number">6</span>a <span class="number">61</span> <span class="number">76</span> </span><br><span class="line"><span class="number">0000600</span> <span class="number">61</span> <span class="number">2</span>f <span class="number">69</span> <span class="number">6</span>f <span class="number">2</span>f <span class="number">50</span> <span class="number">72</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">65</span> <span class="number">61</span> <span class="number">6</span>d </span><br><span class="line"><span class="number">0000620</span> <span class="number">01</span> <span class="number">00</span> <span class="number">07</span> <span class="number">70</span> <span class="number">72</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">74</span> <span class="number">6</span>c <span class="number">6</span>e <span class="number">01</span> <span class="number">00</span> <span class="number">15</span> <span class="number">28</span> <span class="number">4</span>c <span class="number">6</span>a </span><br><span class="line"><span class="number">0000640</span> <span class="number">61</span> <span class="number">76</span> <span class="number">61</span> <span class="number">2</span>f <span class="number">6</span>c <span class="number">61</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">2</span>f <span class="number">53</span> <span class="number">74</span> <span class="number">72</span> <span class="number">69</span> <span class="number">6</span>e <span class="number">67</span> <span class="number">3</span>b </span><br><span class="line"><span class="number">0000660</span> <span class="number">29</span> <span class="number">56</span> <span class="number">00</span> <span class="number">21</span> <span class="number">00</span> <span class="number">05</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">01</span> </span><br><span class="line"><span class="number">0000700</span> <span class="number">00</span> <span class="number">07</span> <span class="number">00</span> <span class="number">08</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">09</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">2</span>f <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">01</span> </span><br><span class="line"><span class="number">0000720</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">2</span>a b7 <span class="number">00</span> <span class="number">01</span> b1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">0</span>a <span class="number">00</span> </span><br><span class="line"><span class="number">0000740</span> <span class="number">00</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">04</span> <span class="number">00</span> <span class="number">0</span>b <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>c <span class="number">00</span> </span><br><span class="line"><span class="number">0000760</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">00</span> <span class="number">0</span>c <span class="number">00</span> <span class="number">0</span>d <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">09</span> <span class="number">00</span> <span class="number">0</span>e <span class="number">00</span> </span><br><span class="line"><span class="number">0001000</span> <span class="number">0</span>f <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">09</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">37</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">0001020</span> <span class="number">09</span> b2 <span class="number">00</span> <span class="number">02</span> <span class="number">12</span> <span class="number">03</span> b6 <span class="number">00</span> <span class="number">04</span> b1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">0</span>a </span><br><span class="line"><span class="number">0001040</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>a <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">06</span> <span class="number">00</span> <span class="number">08</span> <span class="number">00</span> <span class="number">07</span> <span class="number">00</span> <span class="number">0</span>b </span><br><span class="line"><span class="number">0001060</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">0</span>c <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">09</span> <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> </span><br><span class="line"><span class="number">0001100</span> <span class="number">00</span> <span class="number">12</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">05</span> <span class="number">01</span> <span class="number">00</span> <span class="number">10</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">01</span> <span class="number">00</span> <span class="number">13</span> <span class="number">00</span> </span><br><span class="line"><span class="number">0001120</span> <span class="number">00</span> <span class="number">00</span> <span class="number">02</span> <span class="number">00</span> <span class="number">14</span></span><br></pre></td></tr></table></figure>

<p>根据JVM规范, 类文件结构如下:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile &#123;</span><br><span class="line">    u4 			   magic</span><br><span class="line">    u2             minor_version;    </span><br><span class="line">    u2             major_version;    </span><br><span class="line">    u2             constant_pool_count;    </span><br><span class="line">    cp_info        constant_pool[constant_pool_count-<span class="number">1</span>];    </span><br><span class="line">    u2             access_flags;    </span><br><span class="line">    u2             this_class;    </span><br><span class="line">    u2             super_class;   </span><br><span class="line">    u2             interfaces_count;    </span><br><span class="line">    u2             interfaces[interfaces_count];   </span><br><span class="line">    u2             fields_count;    </span><br><span class="line">    field_info     fields[fields_count];   </span><br><span class="line">    u2             methods_count;    </span><br><span class="line">    method_info    methods[methods_count];    </span><br><span class="line">    u2             attributes_count;    </span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="魔数"><a href="#魔数" class="headerlink" title="魔数"></a>魔数</h3><p>u4 magic<br>对应字节码文件的 0~3 个字节, 表示它是否是一个Java的class文件<br>0000000 <strong>ca fe ba be</strong> 00 00 00 34 00 23 0a 00 06 00 15 09</p>
<h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><p>u2 minor_version;<br>u2 major_version;<br>0000000 ca fe ba be <strong>00 00 00 34</strong> 00 23 0a 00 06 00 15 09<br>00 00 00 34 : 34H(16进制) = 52(10进制), 表示是JDK8</p>
<h3 id="常量池"><a href="#常量池" class="headerlink" title="常量池"></a>常量池</h3><table>
<thead>
<tr>
<th>Constant Type</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td><code>CONSTANT_Class</code></td>
<td>7</td>
</tr>
<tr>
<td><code>CONSTANT_Fieldref</code></td>
<td>9</td>
</tr>
<tr>
<td><code>CONSTANT_Methodref</code></td>
<td>10</td>
</tr>
<tr>
<td><code>CONSTANT_InterfaceMethodref</code></td>
<td>11</td>
</tr>
<tr>
<td><code>CONSTANT_String</code></td>
<td>8</td>
</tr>
<tr>
<td><code>CONSTANT_Integer</code></td>
<td>3</td>
</tr>
<tr>
<td><code>CONSTANT_Float</code></td>
<td>4</td>
</tr>
<tr>
<td><code>CONSTANT_Long</code></td>
<td>5</td>
</tr>
<tr>
<td><code>CONSTANT_Double</code></td>
<td>6</td>
</tr>
<tr>
<td><code>CONSTANT_NameAndType</code></td>
<td>12</td>
</tr>
<tr>
<td><code>CONSTANT_Utf8</code></td>
<td>1</td>
</tr>
<tr>
<td><code>CONSTANT_MethodHandle</code></td>
<td>15</td>
</tr>
<tr>
<td><code>CONSTANT_MethodType</code></td>
<td>16</td>
</tr>
<tr>
<td><code>CONSTANT_InvokeDynamic</code></td>
<td>18</td>
</tr>
</tbody></table>
<p>8<del>9 字节, 表示常量池长度, 00 23 (35) 表示常量池有 #1</del>#34项, 注意 #0 项不计入, 也没有值<br>0000000 ca fe ba be 00 00 00 34 <strong>00 23</strong> 0a 00 06 00 15 09</p>
<p>第#1项 0a (10) 表示一个 Method 信息, 00 06 (6) 和 00 15 (21) 表示它引用了常量池中 #6 和 #21项来获得这个方法的<strong>所属类</strong>和<strong>方法名</strong><br>0000000 ca fe ba be 00 00 00 34 00 23 <strong>0a 00 06 00 15</strong> 09</p>
<p>第#2项 09 (9) 表示一个 Field 信息, 00 16 (22) 和 00 17 (23) 表示它引用了常量池中 #22 和 # 23 项 来获得这个成员变量的<strong>所属类</strong>和<strong>成员变量名</strong><br>0000000 ca fe ba be 00 00 00 34 00 23 0a 00 06 00 15 <strong>09</strong><br>0000020 <strong>00 16 00 17</strong> 08 00 18 0a 00 19 00 1a 07 00 1b 07</p>
<p>第#3项 08 (8) 表示一个字符串常量名称, 00 18 (24) 表示它引用了常量池中 #24 项<br>0000020 00 16 00 17 <strong>08 00 18</strong> 0a 00 19 00 1a 07 00 1b 07 </p>
<p>第#4项 0a (10) 表示一个 Method 信息, 00 19 (25) 和 00 1a (26) 表示它引用了常量池中 #25 和 #26 项来获得这个方法的<strong>所属类</strong>和<strong>方法名</strong><br>0000020 00 16 00 17 08 00 18 <strong>0a 00 19 00 1a</strong> 07 00 1b 07 </p>
<p>第#5项 07 (7) 表示一个 Class 信息, 00 1b (27) 表示它引用了常量池中 #27 项<br>0000020 00 16 00 17 08 00 18 0a 00 19 00 1a <strong>07 00 1b</strong> 07 </p>
<p>第#6项 07 (7) 表示一个 Class 信息, 00 1c (28) 表示它引用了常量池中 #28 项<br>0000020 00 16 00 17 08 00 18 0a 00 19 00 1a 07 00 1b <strong>07</strong><br>0000040 <strong>00 1c</strong> 01 00 06 3c 69 6e 69 74 3e 01 00 03 28 29 </p>
<p>第#7项 01 (1) 表示一个 utf8 串, 00 06 (6) 表示长度, 3c 69 6e 69 74 3e 是<code><init></code><br>0000040 00 1c 01 <strong>00 06 3c 69 6e 69 74 3e</strong> 01 00 03 28 29 </p>
<p>第#8项 01 (1) 表示一个 utf8 串, 00 03 (3) 表示长度, 28 29 56 是 <code>()V</code> 其实就是表示无参、无返回值<br>0000040 00 1c 01 00 06 3c 69 6e 69 74 3e <strong>01 00 03 28 29</strong><br>0000060 <strong>56</strong> 01 00 04 43 6f 64 65 01 00 0f 4c 69 6e 65 4e </p>
<p>第#9项 01 (1) 表示一个 utf8 串, 00 04 (4) 表示长度, 43 6f 64 65 是<strong>Code</strong><br>0000060 56 <strong>01 00 04 43 6f 64 65</strong> 01 00 0f 4c 69 6e 65 4e </p>
<p>第#10项 01 (1) 表示一个 utf8 串, 00 0f (15) 表示长度, 4c 69 6e 65 4e 75 6d 62 65 72 54 61 62 6c 65 是<strong>LineNumberTable</strong>(方法行号表)<br>0000060 56 01 00 04 43 6f 64 65 <strong>01 00 0f 4c 69 6e 65 4e</strong><br>0000100 <strong>75 6d 62 65 72 54 61 62 6c 65</strong> 01 00 12 4c 6f 63 </p>
<p>第#11项 01 (1) 表示一个 utf8 串, 00 12 (18) 表示长度, 4c 6f 63 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 是<strong>LocalVariableTable</strong>(本地变量表)<br>0000100 75 6d 62 65 72 54 61 62 6c 65 <strong>01 00 12 4c 6f 63</strong><br>0000120 <strong>61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65</strong> 01 </p>
<p>第#12项 01 (1) 表示一个 utf8 串, 00 04 (4) 表示长度, 74 68 69 73 是<code>this</code><br>0000120 61 6c 56 61 72 69 61 62 6c 65 54 61 62 6c 65 <strong>01</strong><br>0000140 <strong>00 04 74 68 69 73</strong> 01 00 1d 4c 63 6e 2f 69 74 63 </p>
<p>第#13项 01(1) 表示一个 utf8 串, 00 1d (29) 表示长度, 是<strong>类型</strong><br>0000140 00 04 74 68 69 73 <strong>01 00 1d 4c 63 6e 2f 69 74 63</strong><br>0000160 <strong>61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c 6f</strong><br>0000200 <strong>57 6f 72 6c 64 3b</strong> 01 00 04 6d 61 69 6e 01 00 16 </p>
<p>第#14项 01 (1) 表示一个 utf8 串, 00 04 (4) 表示长度, 74 68 69 73 <code>main</code><br>0000200 57 6f 72 6c 64 3b <strong>01 00 04 6d 61 69 6e</strong> 01 00 16 </p>
<p>第#15项 01 (1) 表示一个 utf8 串, 00 16 (22) 表示长度, 是<code>([Ljava/lang/String;)V</code>其实就是参数为 字符串数组, 无返回值<br>0000200 57 6f 72 6c 64 3b 01 00 04 6d 61 69 6e <strong>01 00 16</strong><br>0000220 <strong>28 5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72</strong><br>0000240 <strong>69 6e 67 3b 29 56</strong> 01 00 04 61 72 67 73 01 00 13 </p>
<p>第#16项 01 (1) 表示一个 utf8 串, 00 04 (4) 表示长度, 是<code>args</code><br>0000240 69 6e 67 3b 29 56 <strong>01 00 04 61 72 67 73</strong> 01 00 13 </p>
<p>第#17项 01 (1) 表示一个 utf8 串, 00 13 (19) 表示长度, 是<code>[Ljava/lang/String;</code><br>0000240 69 6e 67 3b 29 56 01 00 04 61 72 67 73 <strong>01 00 13</strong><br>0000260 <strong>5b 4c 6a 61 76 61 2f 6c 61 6e 67 2f 53 74 72 69</strong><br>0000300 <strong>6e 67 3b</strong> 01 00 10 4d 65 74 68 6f 64 50 61 72 61 </p>
<p>第#18项 01 (1) 表示一个 utf8 串, 00 10 (16) 表示长度, 是<strong>MethodParameters</strong><br>0000300 6e 67 3b <strong>01 00 10 4d 65 74 68 6f 64 50 61 72 61</strong><br>0000320 <strong>6d 65 74 65 72 73</strong> 01 00 0a 53 6f 75 72 63 65 46 </p>
<p>第#19项 01 (1) 表示一个 utf8 串, 00 0a (10) 表示长度, 是<strong>SourceFile</strong><br>0000320 6d 65 74 65 72 73 <strong>01 00 0a 53 6f 75 72 63 65 46</strong><br>0000340 <strong>69 6c 65</strong> 01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64 </p>
<p>第#20项 01 (1) 表示一个 utf8 串, 00 0f (15) 表示长度, 是<code>HelloWorld.java</code><br>0000340 69 6c 65 <strong>01 00 0f 48 65 6c 6c 6f 57 6f 72 6c 64</strong><br>0000360 <strong>2e 6a 61 76 61</strong> 0c 00 07 00 08 07 00 1d 0c 00 1e </p>
<p>第#21项 0c 表示一个<strong>名</strong>+<strong>类型</strong>, 00 07 (7) 和 00 08 (8) 引用了常量池中 #7 #8 两项<br>0000360 2e 6a 61 76 61 0c <strong>00 07 00 08</strong> 07 00 1d 0c 00 1e </p>
<p>第#22项 07 (7) 表示一个 Class 信息, 00 1d (29) 引用了常量池中 #29 项<br>0000360 2e 6a 61 76 61 0c 00 07 00 08 <strong>07 00 1d</strong> 0c 00 1e </p>
<p>第#23项 0c (12) 表示一个<strong>名</strong>+<strong>类型</strong>, 00 1e(30) 和 00 1f (31)引用了常量池中 #30 #31 两项<br>0000360 2e 6a 61 76 61 0c 00 07 00 08 07 00 1d <strong>0c 00 1e</strong><br>0000400 <strong>00 1f</strong> 01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64 </p>
<p>第#24项 01 (1) 表示一个 utf8 串, 00 0b (11) 表示长度, 是<code>hello world</code><br>0000400 00 1f <strong>01 00 0b 68 65 6c 6c 6f 20 77 6f 72 6c 64</strong> </p>
<p>第#25项 07 (7) 表示一个 Class 信息, 00 20 (32) 引用了常量池中 #32 项<br>0000420 <strong>07 00 20</strong> 0c 00 21 00 22 01 00 1b 63 6e 2f 69 74 </p>
<p>第#26项 0c (12) 表示一个<strong>名</strong>+<strong>类型</strong>, 00 21 (33) 和 00 22 (34)引用了常量池中 #33 #34 两项<br>0000420 07 00 20 <strong>0c 00 21 00 22</strong> 01 00 1b 63 6e 2f 69 74 </p>
<p>第#27项 01 (1) 表示一个 utf8 串, 00 1b (27) 表示长度, 是<strong>类的权限定名</strong><br>0000420 07 00 20 0c 00 21 00 22 <strong>01 00 1b 63 6e 2f 69 74</strong><br>0000440 <strong>63 61 73 74 2f 6a 76 6d 2f 74 35 2f 48 65 6c 6c</strong><br>0000460 <strong>6f 57 6f 72 6c 64</strong> 01 00 10 6a 61 76 61 2f 6c 61 </p>
<p>第#28项 01 (1) 表示一个 utf8 串, 00 10 (16) 表示长度, 是<code>java.lang.Object</code><br>0000460 6f 57 6f 72 6c 64 01 <strong>00 10 6a 61 76 61 2f 6c 61</strong><br>0000500 <strong>6e 67 2f 4f 62 6a 65 63 74</strong> 01 00 10 6a 61 76 61 </p>
<p>第#29项 01 (1) 表示一个 utf8 串, 00 10 (16) 表示长度, 是<code>java.lang.System</code><br>0000500 6e 67 2f 4f 62 6a 65 63 74 <strong>01 00 10 6a 61 76 61</strong><br>0000520 <strong>2f 6c 61 6e 67 2f 53 79 73 74 65 6d</strong> 01 00 03 6f </p>
<p>第#30项 01 (1) 表示一个 utf8 串, 00 03 (3) 表示长度, 是<code>out</code><br>0000520 2f 6c 61 6e 67 2f 53 79 73 74 65 6d <strong>01 00 03 6f</strong><br>0000540 <strong>75 74</strong> 01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72</p>
<p>第#31项 01 (1) 表示一个 utf8 串, 00 15 (21) 表示长度, 是<code>Ljava.io.PrintStream</code><br>0000540 75 74 <strong>01 00 15 4c 6a 61 76 61 2f 69 6f 2f 50 72</strong><br>0000560 <strong>69 6e 74 53 74 72 65 61 6d 3b</strong> 01 00 13 6a 61 76 </p>
<p>第#32项 01 (1) 表示一个 utf8 串, 00 13 (19) 表示长度, 是<code>java.io.PrintStream</code><br>0000560 69 6e 74 53 74 72 65 61 6d 3b <strong>01 00 13 6a 61 76</strong><br>0000600 <strong>61 2f 69 6f 2f 50 72 69 6e 74 53 74 72 65 61 6d</strong> </p>
<p>第#33项 01 (1) 表示一个 utf8 串, 00 07 表示长度, 是<code>println</code><br>0000620 <strong>01 00 07 70 72 69 6e 74 6c 6e</strong> 01 00 15 28 4c 6a </p>
<p>第#34项 01 (1) 表示一个 utf8 串, 00 15 (21) 表示长度, 是<code>(Ljava/lang/String;)V</code><br>0000620 01 00 07 70 72 69 6e 74 6c 6e <strong>01 00 15 28 4c 6a</strong><br>0000640 <strong>61 76 61 2f 6c 61 6e 67 2f 53 74 72 69 6e 67 3b</strong><br>0000660 <strong>29 56</strong> 00 21 00 05 00 06 00 00 00 00 00 02 00 01</p>
<h3 id="访问标识与继承信息"><a href="#访问标识与继承信息" class="headerlink" title="访问标识与继承信息"></a>访问标识与继承信息</h3><table>
<thead>
<tr>
<th>Flag Name</th>
<th>Value</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td><code>ACC_PUBLIC</code></td>
<td>0x0001</td>
<td>Declared public ; may be accessed from outside its  package.</td>
</tr>
<tr>
<td><code>ACC_FINAL</code></td>
<td>0x0010</td>
<td>Declared final ; no subclasses allowed.</td>
</tr>
<tr>
<td><code>ACC_SUPER</code></td>
<td>0x0020</td>
<td>Treat superclass methods specially when invoked by the invokespecial instruction.</td>
</tr>
<tr>
<td><code>ACC_INTERFACE</code></td>
<td>0x0200</td>
<td>Is an interface, not a class.</td>
</tr>
<tr>
<td><code>ACC_ABSTRACT</code></td>
<td>0x0400</td>
<td>Declared abstract ; must not be instantiated.</td>
</tr>
<tr>
<td><code>ACC_SYNTHETIC</code></td>
<td>0x1000</td>
<td>Declared synthetic; not present in the source code.</td>
</tr>
<tr>
<td><code>ACC_ANNOTATION</code></td>
<td>0x2000</td>
<td>Declared as an annotation type.</td>
</tr>
<tr>
<td><code>ACC_ENUM</code></td>
<td>0x4000</td>
<td>Declared as an enum type.</td>
</tr>
</tbody></table>
<p>00 21 表示该 class 是一个类, 公共的 |<br>0000660 29 56 <strong>00 21</strong> 00 05 00 06 00 00 00 00 00 02 00 01</p>
<p>00 05 表示根据常量池中 #5 找到本类全限定名<br>0000660 29 56 00 21 <strong>00 05</strong> 00 06 00 00 00 00 00 02 00 01</p>
<p>00 06 表示根据常量池中 #6 找到父类全限定名<br>0000660 29 56 00 21 00 05 <strong>00 06</strong> 00 00 00 00 00 02 00 01 </p>
<p>00 00 表示接口的数量, 本类为 0<br>0000660 29 56 00 21 00 05 00 06 <strong>00 00</strong> 00 00 00 02 00 01</p>
<h3 id="Field-信息"><a href="#Field-信息" class="headerlink" title="Field 信息"></a>Field 信息</h3><table>
<thead>
<tr>
<th>Filed Type</th>
<th>Type</th>
<th>Interpretation</th>
</tr>
</thead>
<tbody><tr>
<td>B</td>
<td>byte</td>
<td>signed byte</td>
</tr>
<tr>
<td>C</td>
<td>char</td>
<td>Unicode character code point in the Basic Multilingual Plane, encoded with UTF-16</td>
</tr>
<tr>
<td>D</td>
<td>double</td>
<td>double-precision floating-point value</td>
</tr>
<tr>
<td>F</td>
<td>float</td>
<td>single-precision floating-point value</td>
</tr>
<tr>
<td>I</td>
<td>int</td>
<td>integer</td>
</tr>
<tr>
<td>J</td>
<td>long</td>
<td>long integer</td>
</tr>
<tr>
<td>LClassName;</td>
<td>reference</td>
<td>an instance of class ClassName</td>
</tr>
<tr>
<td>S</td>
<td>short</td>
<td>signed short</td>
</tr>
<tr>
<td>Z</td>
<td>boolean</td>
<td>true or false</td>
</tr>
<tr>
<td>[</td>
<td>reference</td>
<td>one array dimension</td>
</tr>
</tbody></table>
<p>00 00 表示成员变量数量, 本类为 0<br>0000660 29 56 00 21 00 05 00 06 00 00 <strong>00 00</strong> 00 02 00 01</p>
<h3 id="Method-信息"><a href="#Method-信息" class="headerlink" title="Method 信息"></a>Method 信息</h3><p>00 02 表示方法数量, 本类为 2<br>0000660 29 56 00 21 00 05 00 06 00 00 00 00 <strong>00 02</strong> 00 01</p>
<p>一个方法由 访问修饰符, 名称, 参数描述, 方法属性数量, 方法属性组成</p>
<p>具体分析参考文献<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">&lt;(￣︶￣)↗[GO!]</a></p>
<h2 id="2-字节码指令"><a href="#2-字节码指令" class="headerlink" title="2. 字节码指令"></a>2. 字节码指令</h2><p>参考文档<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-6.html#jvms-6.5">&lt;(￣︶￣)↗[GO!]</a></p>
<h3 id="javap工具"><a href="#javap工具" class="headerlink" title="javap工具"></a>javap工具</h3><p>Java 中提供了 javap 工具来反编译 class 文件</p>
<p><code>javap -v HelloWorld.class</code></p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">Classfile /D:/JVM/JVM_Study/out/production/JVM_Study/com/ayu3/HelloWorld.class</span><br><span class="line">  Last modified <span class="number">2022</span>-<span class="number">4</span>-<span class="number">28</span>; size <span class="number">551</span> bytes</span><br><span class="line">  MD5 checksum <span class="number">98</span>a3ae1e037cc97cf9c0a159278e0d47</span><br><span class="line">  Compiled from &quot;HelloWorld.java&quot;</span><br><span class="line">public class com.ayu3.HelloWorld</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line"><span class="function">  flags: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_SUPER</span></span></span><br><span class="line"><span class="function"><span class="title">Constant</span> <span class="title">pool</span>:</span></span><br><span class="line"><span class="function">   #1 = <span class="title">Methodref</span>          #6.#20         // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span>.&quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">   #2 = <span class="title">Fieldref</span>           #21.#22        // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System.out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">   #3 = <span class="title">String</span>             #23            // <span class="title">Hello</span> <span class="title">World</span></span></span><br><span class="line"><span class="function">   #4 = <span class="title">Methodref</span>          #24.#25        // <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream.println</span>:(<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">   #5 = <span class="title">Class</span>              #26            // <span class="title">com</span>/<span class="title">ayu3</span>/<span class="title">HelloWorld</span></span></span><br><span class="line"><span class="function">   #6 = <span class="title">Class</span>              #27            // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span></span></span><br><span class="line"><span class="function">   #7 = <span class="title">Utf8</span>               &lt;<span class="title">init</span>&gt;</span></span><br><span class="line"><span class="function">   #8 = <span class="title">Utf8</span>               ()<span class="title">V</span></span></span><br><span class="line"><span class="function">   #9 = <span class="title">Utf8</span>               <span class="title">Code</span></span></span><br><span class="line"><span class="function">  #10 = <span class="title">Utf8</span>               <span class="title">LineNumberTable</span></span></span><br><span class="line"><span class="function">  #11 = <span class="title">Utf8</span>               <span class="title">LocalVariableTable</span></span></span><br><span class="line"><span class="function">  #12 = <span class="title">Utf8</span>               <span class="title">this</span></span></span><br><span class="line"><span class="function">  #13 = <span class="title">Utf8</span>               <span class="title">Lcom</span>/<span class="title">ayu3</span>/<span class="title">HelloWorld</span>;</span></span><br><span class="line"><span class="function">  #14 = <span class="title">Utf8</span>               <span class="title">main</span></span></span><br><span class="line"><span class="function">  #15 = <span class="title">Utf8</span>               ([<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">  #16 = <span class="title">Utf8</span>               <span class="title">args</span></span></span><br><span class="line"><span class="function">  #17 = <span class="title">Utf8</span>               [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">  #18 = <span class="title">Utf8</span>               <span class="title">SourceFile</span></span></span><br><span class="line"><span class="function">  #19 = <span class="title">Utf8</span>               <span class="title">HelloWorld.java</span></span></span><br><span class="line"><span class="function">  #20 = <span class="title">NameAndType</span>        #7:#8          // &quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">  #21 = <span class="title">Class</span>              #28            // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System</span></span></span><br><span class="line"><span class="function">  #22 = <span class="title">NameAndType</span>        #29:#30        // <span class="title">out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">  #23 = <span class="title">Utf8</span>               <span class="title">Hello</span> <span class="title">World</span></span></span><br><span class="line"><span class="function">  #24 = <span class="title">Class</span>              #31            // <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream</span></span></span><br><span class="line"><span class="function">  #25 = <span class="title">NameAndType</span>        #32:#33        // <span class="title">println</span>:(<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">  #26 = <span class="title">Utf8</span>               <span class="title">com</span>/<span class="title">ayu3</span>/<span class="title">HelloWorld</span></span></span><br><span class="line"><span class="function">  #27 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span></span></span><br><span class="line"><span class="function">  #28 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System</span></span></span><br><span class="line"><span class="function">  #29 = <span class="title">Utf8</span>               <span class="title">out</span></span></span><br><span class="line"><span class="function">  #30 = <span class="title">Utf8</span>               <span class="title">Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">  #31 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream</span></span></span><br><span class="line"><span class="function">  #32 = <span class="title">Utf8</span>               <span class="title">println</span></span></span><br><span class="line"><span class="function">  #33 = <span class="title">Utf8</span>               (<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line"><span class="function">  <span class="title">public</span> <span class="title">com.ayu3.HelloWorld</span>();</span></span><br><span class="line"><span class="function">    <span class="title">descriptor</span>: ()<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=1, <span class="title">locals</span>=1, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">aload_0</span></span></span><br><span class="line"><span class="function">         1: <span class="title">invokespecial</span> #1                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span>.&quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">         4: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 8: 0</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0       5     0  <span class="title">this</span>   <span class="title">Lcom</span>/<span class="title">ayu3</span>/<span class="title">HelloWorld</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">public</span> <span class="title">static</span> <span class="title">void</span> <span class="title">main</span>(<span class="title">java.lang.String</span>[]);</span></span><br><span class="line"><span class="function">    <span class="title">descriptor</span>: ([<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_STATIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=2, <span class="title">locals</span>=1, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">getstatic</span>     #2                  // <span class="title">Field</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System.out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">         3: <span class="title">ldc</span>           #3                  // <span class="title">String</span> <span class="title">Hello</span> <span class="title">World</span></span></span><br><span class="line"><span class="function">         5: <span class="title">invokevirtual</span> #4                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream.println</span>:(<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">         8: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 10: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 11: 8</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0       9     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"><span class="title">SourceFile</span>: &quot;<span class="title">HelloWorld.java</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="图解方法执行流程"><a href="#图解方法执行流程" class="headerlink" title="图解方法执行流程"></a>图解方法执行流程</h3><h3 id="原始代码"><a href="#原始代码" class="headerlink" title="原始代码"></a>原始代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> b = Short.MAX_VALUE + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> c = a + b;</span><br><span class="line">        System.out.println(c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编译后的字节码文件"><a href="#编译后的字节码文件" class="headerlink" title="编译后的字节码文件"></a>编译后的字节码文件</h3><figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">Classfile /D:/JVM/JVM_Study/out/production/JVM_Study/com/ayu3/Demo.class</span><br><span class="line">  Last modified <span class="number">2022</span>-<span class="number">5</span>-<span class="number">2</span>; size <span class="number">592</span> bytes</span><br><span class="line">  MD5 checksum <span class="number">009</span>af49aba8415c333bdf2ef251bc500</span><br><span class="line">  Compiled from &quot;Demo.java&quot;</span><br><span class="line">public class com.ayu3.Demo</span><br><span class="line">  minor version: <span class="number">0</span></span><br><span class="line">  major version: <span class="number">52</span></span><br><span class="line"><span class="function">  flags: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_SUPER</span></span></span><br><span class="line"><span class="function"><span class="title">Constant</span> <span class="title">pool</span>:</span></span><br><span class="line"><span class="function">   #1 = <span class="title">Methodref</span>          #7.#25         // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span>.&quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">   #2 = <span class="title">Class</span>              #26            // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Short</span></span></span><br><span class="line"><span class="function">   #3 = <span class="title">Integer</span>            32768</span></span><br><span class="line"><span class="function">   #4 = <span class="title">Fieldref</span>           #27.#28        // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System.out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">   #5 = <span class="title">Methodref</span>          #29.#30        // <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream.println</span>:(<span class="title">I</span>)<span class="title">V</span></span></span><br><span class="line"><span class="function">   #6 = <span class="title">Class</span>              #31            // <span class="title">com</span>/<span class="title">ayu3</span>/<span class="title">Demo</span></span></span><br><span class="line"><span class="function">   #7 = <span class="title">Class</span>              #32            // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span></span></span><br><span class="line"><span class="function">   #8 = <span class="title">Utf8</span>               &lt;<span class="title">init</span>&gt;</span></span><br><span class="line"><span class="function">   #9 = <span class="title">Utf8</span>               ()<span class="title">V</span></span></span><br><span class="line"><span class="function">  #10 = <span class="title">Utf8</span>               <span class="title">Code</span></span></span><br><span class="line"><span class="function">  #11 = <span class="title">Utf8</span>               <span class="title">LineNumberTable</span></span></span><br><span class="line"><span class="function">  #12 = <span class="title">Utf8</span>               <span class="title">LocalVariableTable</span></span></span><br><span class="line"><span class="function">  #13 = <span class="title">Utf8</span>               <span class="title">this</span></span></span><br><span class="line"><span class="function">  #14 = <span class="title">Utf8</span>               <span class="title">Lcom</span>/<span class="title">ayu3</span>/<span class="title">Demo</span>;</span></span><br><span class="line"><span class="function">  #15 = <span class="title">Utf8</span>               <span class="title">main</span></span></span><br><span class="line"><span class="function">  #16 = <span class="title">Utf8</span>               ([<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">  #17 = <span class="title">Utf8</span>               <span class="title">args</span></span></span><br><span class="line"><span class="function">  #18 = <span class="title">Utf8</span>               [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">  #19 = <span class="title">Utf8</span>               <span class="title">a</span></span></span><br><span class="line"><span class="function">  #20 = <span class="title">Utf8</span>               <span class="title">I</span></span></span><br><span class="line"><span class="function">  #21 = <span class="title">Utf8</span>               <span class="title">b</span></span></span><br><span class="line"><span class="function">  #22 = <span class="title">Utf8</span>               <span class="title">c</span></span></span><br><span class="line"><span class="function">  #23 = <span class="title">Utf8</span>               <span class="title">SourceFile</span></span></span><br><span class="line"><span class="function">  #24 = <span class="title">Utf8</span>               <span class="title">Demo.java</span></span></span><br><span class="line"><span class="function">  #25 = <span class="title">NameAndType</span>        #8:#9          // &quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">  #26 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Short</span></span></span><br><span class="line"><span class="function">  #27 = <span class="title">Class</span>              #33            // <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System</span></span></span><br><span class="line"><span class="function">  #28 = <span class="title">NameAndType</span>        #34:#35        // <span class="title">out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">  #29 = <span class="title">Class</span>              #36            // <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream</span></span></span><br><span class="line"><span class="function">  #30 = <span class="title">NameAndType</span>        #37:#38        // <span class="title">println</span>:(<span class="title">I</span>)<span class="title">V</span></span></span><br><span class="line"><span class="function">  #31 = <span class="title">Utf8</span>               <span class="title">com</span>/<span class="title">ayu3</span>/<span class="title">Demo</span></span></span><br><span class="line"><span class="function">  #32 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span></span></span><br><span class="line"><span class="function">  #33 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System</span></span></span><br><span class="line"><span class="function">  #34 = <span class="title">Utf8</span>               <span class="title">out</span></span></span><br><span class="line"><span class="function">  #35 = <span class="title">Utf8</span>               <span class="title">Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">  #36 = <span class="title">Utf8</span>               <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream</span></span></span><br><span class="line"><span class="function">  #37 = <span class="title">Utf8</span>               <span class="title">println</span></span></span><br><span class="line"><span class="function">  #38 = <span class="title">Utf8</span>               (<span class="title">I</span>)<span class="title">V</span></span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line"><span class="function">  <span class="title">public</span> <span class="title">com.ayu3.Demo</span>();</span></span><br><span class="line"><span class="function">    <span class="title">descriptor</span>: ()<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=1, <span class="title">locals</span>=1, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">aload_0</span></span></span><br><span class="line"><span class="function">         1: <span class="title">invokespecial</span> #1                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span>.&quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">         4: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 8: 0</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0       5     0  <span class="title">this</span>   <span class="title">Lcom</span>/<span class="title">ayu3</span>/<span class="title">Demo</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">public</span> <span class="title">static</span> <span class="title">void</span> <span class="title">main</span>(<span class="title">java.lang.String</span>[]);</span></span><br><span class="line"><span class="function">    <span class="title">descriptor</span>: ([<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_STATIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=2, <span class="title">locals</span>=4, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">bipush</span>        10</span></span><br><span class="line"><span class="function">         2: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         3: <span class="title">ldc</span>           #3                  // <span class="title">int</span> 32768</span></span><br><span class="line"><span class="function">         5: <span class="title">istore_2</span></span></span><br><span class="line"><span class="function">         6: <span class="title">iload_1</span></span></span><br><span class="line"><span class="function">         7: <span class="title">iload_2</span></span></span><br><span class="line"><span class="function">         8: <span class="title">iadd</span></span></span><br><span class="line"><span class="function">         9: <span class="title">istore_3</span></span></span><br><span class="line"><span class="function">        10: <span class="title">getstatic</span>     #4                  // <span class="title">Field</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System.out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">        13: <span class="title">iload_3</span></span></span><br><span class="line"><span class="function">        14: <span class="title">invokevirtual</span> #5                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream.println</span>:(<span class="title">I</span>)<span class="title">V</span></span></span><br><span class="line"><span class="function">        17: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 10: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 11: 3</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 12: 6</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 13: 10</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 14: 17</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0      18     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">            3      15     1     <span class="title">a</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function">            6      12     2     <span class="title">b</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function">           10       8     3     <span class="title">c</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"><span class="title">SourceFile</span>: &quot;<span class="title">Demo.java</span>&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="常量池载入运行时常量池"><a href="#常量池载入运行时常量池" class="headerlink" title="常量池载入运行时常量池"></a>常量池载入运行时常量池</h3><p>常量池也属于方法区, 只不过这里单独提出来了</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/%E8%BD%BD%E5%85%A5%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0.png" alt="载入运行时常量池"></p>
<h3 id="方法字节码载入方法区"><a href="#方法字节码载入方法区" class="headerlink" title="方法字节码载入方法区"></a>方法字节码载入方法区</h3><p>(stack=2, locals=4) 对应操作数栈有 2 个空间(每个空间 4 个字节), 局部变量表中有 4 个槽位</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/%E8%BD%BD%E5%85%A5%E6%96%B9%E6%B3%95%E5%8C%BA.png" alt="载入方法区"></p>
<h3 id="main-线程开始运行-分配栈帧内存"><a href="#main-线程开始运行-分配栈帧内存" class="headerlink" title="main 线程开始运行, 分配栈帧内存"></a>main 线程开始运行, 分配栈帧内存</h3><p>(stack=2, locals=4)</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/%E5%88%86%E9%85%8D%E6%A0%88%E5%B8%A7%E5%86%85%E5%AD%98.png" alt="分配栈帧内存"></p>
<h3 id="执行引擎开始执行字节码"><a href="#执行引擎开始执行字节码" class="headerlink" title="执行引擎开始执行字节码"></a>执行引擎开始执行字节码</h3><p><strong>bipush 10</strong></p>
<ul>
<li>将一个 byte 压入操作数栈(其长度会补齐 4 个字节), 类似的指令还有</li>
<li>sipush 将一个 short 压入操作数栈(其长度会补齐 4 个字节)</li>
<li>ldc 将一个 int 压入操作数栈</li>
<li>ldc2_w 将一个 long 压入操作数栈(分两次压入, 因为 long 是 8 个字节)</li>
<li>这里小的数字都是和字节码指令存在一起, 超过 short 范围的数字存入了常量池</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/bipush10.png" alt="bipush10"></p>
<p><strong>istore 1</strong></p>
<ul>
<li>将操作数栈栈顶元素弹出, 放入局部变量表的 slot 1 中</li>
<li>对应代码中的 a = 10</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/istore_1-1.png" alt="istore_1-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/istore_1-2.png" alt="istore_1-2"></p>
<p><strong>ldc #3</strong></p>
<ul>
<li>读取运行时常量池中 #3 , 即 32768 (超过 short 最大值范围的数会被放到运行时常量池中), 将其加载到操作数栈中</li>
<li>注意: Short.MAX_VALUE 是 32767, 所以 32768 = Short.MAX_VALUE + 1 实际是在编译期间计算好的</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/ldc3.png" alt="ldc#3"></p>
<p><strong>istore 2</strong></p>
<ul>
<li>将操作数栈中的元素弹出, 放到局部变量表的 2 号位置</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/istore_2-1.png" alt="istore_2-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/istore_2-2.png" alt="istore_2-2"></p>
<p><strong>iload1 iload2</strong></p>
<ul>
<li>将局部变量表中 1 号位置和 2 号位置的元素放入操作数栈中</li>
<li>因为只能在操作数栈中执行运算操作</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/iload_1.png" alt="iload_1"><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/iload_2.png" alt="iload_2"></p>
<p><strong>iadd</strong></p>
<ul>
<li>将操作数栈中的两个元素弹出栈并相加, 结果在压入操作数栈中</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/iadd-1.png" alt="iadd-1"><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/iadd-2.png" alt="iadd-2"></p>
<p><strong>istore 3</strong></p>
<ul>
<li>将操作数栈中的元素弹出, 放入局部变量表的3号位置</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/istore_3-1.png" alt="istore_3-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/istore_3-2.png" alt="istore_3-1"></p>
<p><strong>getstatic #4</strong></p>
<ul>
<li><p>在运行时常量池中找到 #4 , 发现是一个对象</p>
</li>
<li><p>在堆内存中找到该对象, 并将其引用放入操作数栈中</p>
</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/getstatic4-1.png"><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/getstatic4-2.png" alt="getstatic4-2"></p>
<p><strong>iload 3</strong></p>
<ul>
<li>将局部变量表中 3 号位置的元素压入操作数栈中</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/iload_3-1.png" alt="iload_3-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/iload_3-2.png" alt="iload_3-1"></p>
<p><strong>invokevirtual #5</strong></p>
<ul>
<li>找到常量池 #5 项</li>
<li>定位到方法区 java/io/PrintStream.println:(I)V 方法</li>
<li>生成新的栈帧(分配 locals、stack等)</li>
<li>传递参数, 执行新栈帧中的字节码</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/invokevirtual5-1.png" alt="invokevirtual5-1"></p>
<ul>
<li>执行完毕, 弹出栈帧</li>
<li>清除 main 操作数栈内容</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/invokevirtual5-2.png" alt="invokevirtual5-2"></p>
<p><strong>return</strong></p>
<ul>
<li>完成 main 方法调用, 弹出 main 栈帧</li>
<li>程序结束</li>
</ul>
<h3 id="分析a"><a href="#分析a" class="headerlink" title="分析a++"></a>分析a++</h3><p>代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">        <span class="keyword">int</span> b = a++ + ++a + a--;</span><br><span class="line">        System.out.println(a);</span><br><span class="line">        System.out.println(b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  public com.ayu3.Demo();</span><br><span class="line"><span class="function">    descriptor: ()<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=1, <span class="title">locals</span>=1, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">aload_0</span></span></span><br><span class="line"><span class="function">         1: <span class="title">invokespecial</span> #1                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span>.&quot;&lt;<span class="title">init</span>&gt;&quot;:()<span class="title">V</span></span></span><br><span class="line"><span class="function">         4: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 8: 0</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0       5     0  <span class="title">this</span>   <span class="title">Lcom</span>/<span class="title">ayu3</span>/<span class="title">Demo</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">  <span class="title">public</span> <span class="title">static</span> <span class="title">void</span> <span class="title">main</span>(<span class="title">java.lang.String</span>[]);</span></span><br><span class="line"><span class="function">    <span class="title">descriptor</span>: ([<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_STATIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=2, <span class="title">locals</span>=3, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">bipush</span>        10</span></span><br><span class="line"><span class="function">         2: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         3: <span class="title">iload_1</span></span></span><br><span class="line"><span class="function">         4: <span class="title">iinc</span>          1, 1</span></span><br><span class="line"><span class="function">         7: <span class="title">iinc</span>          1, 1</span></span><br><span class="line"><span class="function">        10: <span class="title">iload_1</span></span></span><br><span class="line"><span class="function">        11: <span class="title">iadd</span></span></span><br><span class="line"><span class="function">        12: <span class="title">iload_1</span></span></span><br><span class="line"><span class="function">        13: <span class="title">iinc</span>          1, -1</span></span><br><span class="line"><span class="function">        16: <span class="title">iadd</span></span></span><br><span class="line"><span class="function">        17: <span class="title">istore_2</span></span></span><br><span class="line"><span class="function">        18: <span class="title">getstatic</span>     #2                  // <span class="title">Field</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System.out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">        21: <span class="title">iload_1</span></span></span><br><span class="line"><span class="function">        22: <span class="title">invokevirtual</span> #3                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream.println</span>:(<span class="title">I</span>)<span class="title">V</span></span></span><br><span class="line"><span class="function">        25: <span class="title">getstatic</span>     #2                  // <span class="title">Field</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">System.out:Ljava</span>/<span class="title">io</span>/<span class="title">PrintStream</span>;</span></span><br><span class="line"><span class="function">        28: <span class="title">iload_2</span></span></span><br><span class="line"><span class="function">        29: <span class="title">invokevirtual</span> #3                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">io</span>/<span class="title">PrintStream.println</span>:(<span class="title">I</span>)<span class="title">V</span></span></span><br><span class="line"><span class="function">        32: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 10: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 11: 3</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 12: 18</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 13: 25</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 14: 32</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0      33     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">            3      30     1     <span class="title">a</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function">           18      15     2     <span class="title">b</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>

<p>分析: </p>
<ul>
<li>注意 iinc 指令是直接在局部变量 slot 上进行运算 </li>
<li>a++ 和 ++a 的区别是先执行 iload 还是 先执行 iinc</li>
</ul>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-1.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-2.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-3.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-4.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-5.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-6.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-7.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-8.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-9.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-10.png" alt="a++-1"></p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/a++-11.png" alt="a++-1"></p>
<h3 id="条件判断指令"><a href="#条件判断指令" class="headerlink" title="条件判断指令"></a>条件判断指令</h3><table>
<thead>
<tr>
<th>指令</th>
<th>助记符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>0×99</td>
<td>ifeq</td>
<td>判断是否 == 0</td>
</tr>
<tr>
<td>0×9a</td>
<td>ifne</td>
<td>判断是否 != 0</td>
</tr>
<tr>
<td>0×9b</td>
<td>iflt</td>
<td>判断是否 &lt; 0</td>
</tr>
<tr>
<td>0×9c</td>
<td>ifge</td>
<td>判断是否 &gt;= 0</td>
</tr>
<tr>
<td>0×9d</td>
<td>ifgt</td>
<td>判断是否 &gt; 0</td>
</tr>
<tr>
<td>0×9e</td>
<td>ifle</td>
<td>判断是否 &lt;= 0</td>
</tr>
<tr>
<td>0×9f</td>
<td>if_icmpeq</td>
<td>两个int是否 ==</td>
</tr>
<tr>
<td>0×a0</td>
<td>if_icmpne</td>
<td>两个int是否 !=</td>
</tr>
<tr>
<td>0×a1</td>
<td>if_icmplt</td>
<td>两个int是否 &lt;</td>
</tr>
<tr>
<td>0×a2</td>
<td>if_icmpge</td>
<td>两个int是否 &gt;=</td>
</tr>
<tr>
<td>0×a3</td>
<td>if_icmpgt</td>
<td>两个int是否 &gt;</td>
</tr>
<tr>
<td>0×a4</td>
<td>if_icmple</td>
<td>两个int是否 &lt;=</td>
</tr>
<tr>
<td>0×a5</td>
<td>if_acmpeq</td>
<td>两个引用是否 ==</td>
</tr>
<tr>
<td>0×a6</td>
<td>if_acmpne</td>
<td>两个引用是否 !=</td>
</tr>
<tr>
<td>0×c6</td>
<td>ifnull</td>
<td>判断是否 == null</td>
</tr>
<tr>
<td>0×c7</td>
<td>ifnonnull</td>
<td>判断是否 != null</td>
</tr>
</tbody></table>
<p>几点说明: </p>
<ul>
<li>byte, short, char 都会按 int 比较, 因为操作数栈都是 4 字节 </li>
<li>goto 用来进行跳转到指定行号的字节码</li>
</ul>
<p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(a == <span class="number">0</span>) &#123;</span><br><span class="line">            a = <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            a = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">public static void main(java.lang.String[]);</span><br><span class="line"><span class="function">    descriptor: ([<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;)<span class="title">V</span></span></span><br><span class="line"><span class="function">    <span class="title">flags</span>: <span class="title">ACC_PUBLIC</span>, <span class="title">ACC_STATIC</span></span></span><br><span class="line"><span class="function">    <span class="title">Code</span>:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=1, <span class="title">locals</span>=2, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">iconst_0</span></span></span><br><span class="line"><span class="function">         1: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         2: <span class="title">iload_1</span></span></span><br><span class="line"><span class="function">         3: <span class="title">ifne</span>          12</span></span><br><span class="line"><span class="function">         6: <span class="title">bipush</span>        10</span></span><br><span class="line"><span class="function">         8: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         9: <span class="title">goto</span>          15</span></span><br><span class="line"><span class="function">        12: <span class="title">bipush</span>        20</span></span><br><span class="line"><span class="function">        14: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        15: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 10: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 11: 2</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 12: 6</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 14: 12</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 16: 15</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            0      16     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">            2      14     1     <span class="title">a</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function">      <span class="title">StackMapTable</span>: <span class="title">number_of_entries</span> = 2</span></span><br><span class="line"><span class="function">        <span class="title">frame_type</span> = 252 /* <span class="title">append</span> */</span></span><br><span class="line"><span class="function">          <span class="title">offset_delta</span> = 12</span></span><br><span class="line"><span class="function">          <span class="title">locals</span> = [ <span class="title">int</span> ]</span></span><br><span class="line"><span class="function">        <span class="title">frame_type</span> = 2 /* <span class="title">same</span> */</span></span><br></pre></td></tr></table></figure>

<p>参考文档<a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/specs/jvms/se7/html/jvms-6.html#jvms-6.5.lcmp">&lt;(￣︶￣)↗[GO!]</a></p>
<h3 id="循环控制指令"><a href="#循环控制指令" class="headerlink" title="循环控制指令"></a>循环控制指令</h3><p><strong>while循环</strong></p>
<p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">while</span> (a &lt; <span class="number">10</span>) &#123;</span><br><span class="line">    		a++;</span><br><span class="line">   		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: iconst_0</span><br><span class="line"> <span class="number">1</span>: istore_1</span><br><span class="line"> <span class="number">2</span>: iload_1</span><br><span class="line"> <span class="number">3</span>: bipush <span class="number">10</span></span><br><span class="line"> <span class="number">5</span>: if_icmpge <span class="number">14</span></span><br><span class="line"> <span class="number">8</span>: iinc <span class="number">1</span>, <span class="number">1</span></span><br><span class="line"><span class="number">11</span>: <span class="keyword">goto</span> <span class="number">2</span></span><br><span class="line"><span class="number">14</span>: return</span><br></pre></td></tr></table></figure>

<p><strong>dowhile循环</strong></p>
<p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">int</span> a = <span class="number">0</span>;</span><br><span class="line">    	<span class="keyword">do</span> &#123;</span><br><span class="line">			a++;</span><br><span class="line">		&#125; <span class="keyword">while</span> (a &lt; <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: iconst_0</span><br><span class="line"> <span class="number">1</span>: istore_1</span><br><span class="line"> <span class="number">2</span>: iinc <span class="number">1</span>, <span class="number">1</span></span><br><span class="line"> <span class="number">5</span>: iload_1</span><br><span class="line"> <span class="number">6</span>: bipush <span class="number">10</span></span><br><span class="line"> <span class="number">8</span>: if_icmplt <span class="number">2</span></span><br><span class="line"><span class="number">11</span>: return</span><br></pre></td></tr></table></figure>

<p><strong>for循环</strong></p>
<p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: iconst_0</span><br><span class="line"> <span class="number">1</span>: istore_1</span><br><span class="line"> <span class="number">2</span>: iload_1</span><br><span class="line"> <span class="number">3</span>: bipush <span class="number">10</span></span><br><span class="line"> <span class="number">5</span>: if_icmpge <span class="number">14</span></span><br><span class="line"> <span class="number">8</span>: iinc <span class="number">1</span>, <span class="number">1</span></span><br><span class="line"><span class="number">11</span>: <span class="keyword">goto</span> <span class="number">2</span></span><br><span class="line"><span class="number">14</span>: return</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看到循环的底层也是条件判断指令<br>而且比较while和for的字节码, 可以发现是一摸一样的, 所以再有人问while和for那个快这个问题就显而易见了</p>
</blockquote>
<h3 id="通过字节码指令分析问题"><a href="#通过字节码指令分析问题" class="headerlink" title="通过字节码指令分析问题"></a>通过字节码指令分析问题</h3><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> x = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            x = x++;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(x); <span class="comment">// 0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过字节码来看为什么结果是0:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: iconst_0	<span class="comment">// 准备一个常数 0</span></span><br><span class="line"> <span class="number">1</span>: istore_1	<span class="comment">// 将常数 0 放入局部变量表的 1 号槽位 i = 0</span></span><br><span class="line"> <span class="number">2</span>: iconst_0	<span class="comment">// 准备一个常数 0</span></span><br><span class="line"> <span class="number">3</span>: istore_2	<span class="comment">// 将常数 0 放入局部变量的 2 号槽位 x = 0	</span></span><br><span class="line"> <span class="number">4</span>: iload_1		<span class="comment">// 将局部变量表 1 号槽位的数放入操作数栈中</span></span><br><span class="line"> <span class="number">5</span>: bipush        <span class="number">10</span>	<span class="comment">// 将数字 10 放入操作数栈中, 此时操作数栈中有 2 个数</span></span><br><span class="line"> <span class="number">7</span>: if_icmpge     <span class="number">21</span>	<span class="comment">// 比较操作数栈中的两个数, 如果下面的数大于上面的数, 就跳转到 21 。这里的比较是将两个数做减法。因为涉及运算操作, 所以会将两个数弹出操作数栈来进行运算。运算结束后操作数栈为空</span></span><br><span class="line"><span class="number">10</span>: iload_2		<span class="comment">// 将局部变量 2 号槽位的数放入操作数栈中, 放入的值是 0 </span></span><br><span class="line"><span class="number">11</span>: iinc          <span class="number">2</span>, <span class="number">1</span>	<span class="comment">// 将局部变量 2 号槽位的数加 1 , 自增后, 槽位中的值为 1 </span></span><br><span class="line"><span class="number">14</span>: istore_2	<span class="comment">//将操作数栈中的数放入到局部变量表的 2 号槽位, 2 号槽位的值又变为了0</span></span><br><span class="line"><span class="number">15</span>: iinc          <span class="number">1</span>, <span class="number">1</span> <span class="comment">// 1 号槽位的值自增 1 </span></span><br><span class="line"><span class="number">18</span>: goto          <span class="number">4</span> <span class="comment">// 跳转到第4条指令</span></span><br><span class="line"><span class="number">21</span>: getstatic     #<span class="number">2</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line"><span class="number">24</span>: iload_2</span><br><span class="line"><span class="number">25</span>: invokevirtual #<span class="number">3</span>                  <span class="comment">// Method java/io/PrintStream.println:(I)V</span></span><br><span class="line"><span class="number">28</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<h3 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h3><p><code><cinit>()V</code></p>
<p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="keyword">static</span> <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		i = <span class="number">20</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span> &#123;</span><br><span class="line">		i = <span class="number">30</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		System.out.println(i); <span class="comment">// 30</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line"> <span class="number">2</span>: putstatic     #<span class="number">3</span>                  // Field i:I</span><br><span class="line"> <span class="number">5</span>: bipush        <span class="number">20</span></span><br><span class="line"> <span class="number">7</span>: putstatic     #<span class="number">3</span>                  // Field i:I</span><br><span class="line"><span class="number">10</span>: bipush        <span class="number">30</span></span><br><span class="line"><span class="number">12</span>: putstatic     #<span class="number">3</span>                  // Field i:I</span><br><span class="line"><span class="number">15</span>: return</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译器会按从上至下的顺序, 收集所有 static 静态代码块和静态成员赋值的代码, 合并为一个特殊的方法<code><cinit>()V:</code></p>
</blockquote>
<p><code><init>()V</code></p>
<p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String a = <span class="string">&quot;s1&quot;</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        b = <span class="number">20</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> b = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        a = <span class="string">&quot;s2&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Code_13_InitTest</span><span class="params">(String a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.a = a;</span><br><span class="line">        <span class="keyword">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Code_13_InitTest d = <span class="keyword">new</span> Code_13_InitTest(<span class="string">&quot;s3&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        System.out.println(d.a); <span class="comment">//s3</span></span><br><span class="line">        System.out.println(d.b); <span class="comment">//30</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: aload_0</span><br><span class="line"> <span class="number">1</span>: invokespecial #<span class="number">1</span> // super.&lt;init&gt;()V</span><br><span class="line"> <span class="number">4</span>: aload_0</span><br><span class="line"> <span class="number">5</span>: ldc #<span class="number">2</span> // &lt;- &quot;s1&quot;</span><br><span class="line"> <span class="number">7</span>: putfield #<span class="number">3</span> // -&gt; this.a</span><br><span class="line"><span class="number">10</span>: aload_0</span><br><span class="line"><span class="number">11</span>: bipush <span class="number">20</span> // &lt;- <span class="number">20</span></span><br><span class="line"><span class="number">13</span>: putfield #<span class="number">4</span> // -&gt; this.b</span><br><span class="line"><span class="number">16</span>: aload_0</span><br><span class="line"><span class="number">17</span>: bipush <span class="number">10</span> // &lt;- <span class="number">10</span></span><br><span class="line"><span class="number">19</span>: putfield #<span class="number">4</span> // -&gt; this.b</span><br><span class="line"><span class="number">22</span>: aload_0</span><br><span class="line"><span class="number">23</span>: ldc #<span class="number">5</span> // &lt;- &quot;s2&quot;</span><br><span class="line"><span class="number">25</span>: putfield #<span class="number">3</span> // -&gt; this.a</span><br><span class="line"><span class="number">28</span>: aload_0 // ------------------------------</span><br><span class="line"><span class="number">29</span>: aload_1 // &lt;- slot <span class="number">1</span>(a) &quot;s3&quot; </span><br><span class="line"><span class="number">30</span>: putfield #<span class="number">3</span> // -&gt; this.a</span><br><span class="line"><span class="number">33</span>: aload_0 </span><br><span class="line"><span class="number">34</span>: iload_2 // &lt;- slot <span class="number">2</span>(b) <span class="number">30</span></span><br><span class="line"><span class="number">35</span>: putfield #<span class="number">4</span> // -&gt; this.b --------------------</span><br><span class="line"><span class="number">38</span>: return</span><br></pre></td></tr></table></figure>

<blockquote>
<p>编译器会按从上至下的顺序, 收集所有 {} 代码块和成员变量赋值的代码, 形成新的构造方法, 但原始构造方法内的代码总是在最后</p>
</blockquote>
<h3 id="方法调用"><a href="#方法调用" class="headerlink" title="方法调用"></a>方法调用</h3><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo3_9</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Demo3_9</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Demo3_9 d = <span class="keyword">new</span> Demo3_9();</span><br><span class="line">        d.test1();</span><br><span class="line">        d.test2();</span><br><span class="line">        d.test3();</span><br><span class="line">        d.test4();</span><br><span class="line">        Demo3_9.test4();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> <span class="number">0</span>: new #<span class="number">2</span> </span><br><span class="line"> <span class="number">3</span>: dup</span><br><span class="line"> <span class="number">4</span>: invokespecial #<span class="number">3</span> // Method &quot;&lt;init&gt;&quot;:()V</span><br><span class="line"> <span class="number">7</span>: astore_1</span><br><span class="line"> <span class="number">8</span>: aload_1</span><br><span class="line"> <span class="number">9</span>: invokespecial #<span class="number">4</span> // Method test1:()V</span><br><span class="line"><span class="number">12</span>: aload_1</span><br><span class="line"><span class="number">13</span>: invokespecial #<span class="number">5</span> // Method test2:()V</span><br><span class="line"><span class="number">16</span>: aload_1</span><br><span class="line"><span class="number">17</span>: invokevirtual #<span class="number">6</span> // Method test3:()V</span><br><span class="line"><span class="number">20</span>: aload_1</span><br><span class="line"><span class="number">21</span>: pop</span><br><span class="line"><span class="number">22</span>: invokestatic #<span class="number">7</span> // Method test4:()V</span><br><span class="line"><span class="number">25</span>: invokestatic #<span class="number">7</span> // Method test4:()V</span><br><span class="line"><span class="number">28</span>: return</span><br></pre></td></tr></table></figure>

<p>不同方法在调用时, 对应的虚拟机指令有所区别</p>
<ul>
<li>私有、构造、被 final 修饰的方法, 在调用时都使用 invokespecial 指令</li>
<li>普通成员方法在调用时, 使用 invokevirtual 指令。因为编译期间无法确定该方法的内容, 只有在运行期间才能确定</li>
<li>静态方法在调用时使用 invokestatic 指令</li>
<li>new 是创建<strong>对象</strong>, 给对象分配堆内存, 执行成功会将<strong>对象引用</strong>压入操作数栈</li>
<li>dup 是赋值操作数栈栈顶的内容, 本例即为<strong>对象引用</strong>, 为什么需要两份引用呢, 一个是要配合 invokespecial 调用该对象的构造方法 <code>“init”: ()V</code> (会消耗掉栈顶一个引用), 另一个要 配合 astore_1 赋值给局部变量</li>
<li>终方法(ﬁnal), 私有方法(private), 构造方法都是由 invokespecial 指令来调用, 属于静态绑定</li>
<li>普通成员方法是由 invokevirtual 调用, 属于动态绑定, 即支持多态 成员方法与静态方法调用的另一个区别是, 执行方法前是否需要<strong>对象引用</strong></li>
</ul>
<h3 id="多态原理"><a href="#多态原理" class="headerlink" title="多态原理"></a>多态原理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 演示多态原理, 注意加上下面的 JVM 参数, 禁用指针压缩</span></span><br><span class="line"><span class="comment">  * -XX:-UseCompressedOops -XX:-UseCompressedClassPointers</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Animal animal)</span> </span>&#123;</span><br><span class="line">        animal.eat();</span><br><span class="line">        System.out.println(animal.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        test(<span class="keyword">new</span> Cat());</span><br><span class="line">        test(<span class="keyword">new</span> Dog());</span><br><span class="line">        System.in.read();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;我是&quot;</span> + <span class="keyword">this</span>.getClass().getSimpleName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;啃骨头&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;吃鱼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>运行代码</strong></p>
<p>使用jps获取进程id</p>
<p><strong>运行 HSDB 工具</strong></p>
<p>进入 JDK 安装目录, 执行<code>java -cp ./lib/sa-jdi.jar sun.jvm.hotspot.HSDB</code></p>
<p>进入图形界面 attach 进程 id , File -&gt; Attach to HoTSpot process</p>
<p><strong>查找某个对象</strong></p>
<p>打开 Tools -&gt; Find Object By Query</p>
<p>输入 <code>select d from com.ayu3.Dog d</code> 点击 Execute 执行</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/%E6%9F%A5%E6%89%BE%E5%AF%B9%E8%B1%A1.png" alt="查找对象"></p>
<p><strong>查看对象内存结构</strong></p>
<p>点击超链接可以看到对象的内存结构, 此对象没有任何属性, 因此只有对象头的 16 字节, 前 8 字节是 MarkWord, 后 8 字节就是对象的 Class 指针, 但目前看不到它的实际地址</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84.png" alt="对象内存结构"></p>
<p><strong>查看对象 Class 的内存地址</strong></p>
<p>可以通过 Windows -&gt; Console 进入命令行模式, 执行<code>mem 0x00000000d447ef70 2</code><br>mem 有两个参数, 参数 1 是对象地址, 参数 2 是查看 2 行(即 16 字节)<br>结果中第二行 0x0000000017e641a0 即为 Class 的内存地址</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/Class%E5%86%85%E5%AD%98%E5%9C%B0%E5%9D%80.png" alt="Class内存地址"></p>
<p><strong>查看类的 vtable</strong></p>
<p>Alt+R 进入 Inspector 工具, 输入刚才的 Class 内存地址, 看到如下界面</p>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/Inspector.png" alt="Inspector"></p>
<p>从 Class 的起始地址开始算, 偏移 0x1b8 就是 vtable 的起始地址, 进行计算得到: </p>
<blockquote>
<p>0x0000000017e641a0 + 1b8 = 0x0000000017e64358</p>
</blockquote>
<p><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/vtable.png" alt="vtable"></p>
<p>并且得知Dog Class 的 vtable 长度为 6, 意思就是 Dog 类有 6 个虚方法(多态相关的, final, static 不会列入)</p>
<p>通过 Windows -&gt; Console 进入命令行模式, 执行</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mem <span class="number">0</span>x0000000017e64358 <span class="number">6</span></span><br><span class="line"><span class="number">0</span>x0000000017e64358: <span class="number">0</span>x0000000017a61b10 </span><br><span class="line"><span class="number">0</span>x0000000017e64360: <span class="number">0</span>x0000000017a615e8 </span><br><span class="line"><span class="number">0</span>x0000000017e64368: <span class="number">0</span>x0000000017e63758 </span><br><span class="line"><span class="number">0</span>x0000000017e64370: <span class="number">0</span>x0000000017a61540 </span><br><span class="line"><span class="number">0</span>x0000000017e64378: <span class="number">0</span>x0000000017a61678 </span><br><span class="line"><span class="number">0</span>x0000000017e64380: <span class="number">0</span>x0000000017e64148 </span><br></pre></td></tr></table></figure>

<p>就得到了 6 个虚方法的入口地址</p>
<p><strong>验证方法地址</strong></p>
<p>通过 Tools -&gt; Class Browser 查看每个类的方法定义, 比较可知</p>
<blockquote>
<p>Dog - public void eat() @0x0000000017e64148</p>
<p>Animal - public java.lang.String toString() @0x0000000017e63758</p>
<p>Object - protected void finalize() @0x0000000017a61b10<br>Object - public boolean equals(java.lang.Object) @0x0000000017a615e8<br>Object - public native int hashCode() @0x0000000017a61540<br>Object - protected native java.lang.Object clone() @0x0000000017a61678</p>
</blockquote>
<p>对号入座, 发现</p>
<ul>
<li>eat() 方法是 Dog 类自己的 </li>
<li>toString() 方法是继承 String 类的 </li>
<li>finalize() , equals(), hashCode(), clone() 都是继承 Object 类的</li>
</ul>
<p><strong>小结</strong></p>
<p>当执行 invokevirtual 指令时</p>
<ol>
<li>先通过栈帧中的对象引用找到对象 </li>
<li>分析对象头, 找到对象的实际 Class </li>
<li>Class 结构中有 vtable, 它在类加载的链接阶段就已经根据方法的重写规则生成好了 </li>
<li>查表得到方法的具体地址 </li>
<li>执行方法的字节码</li>
</ol>
<h3 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h3><h4 id="try-catch"><a href="#try-catch" class="headerlink" title="try-catch"></a>try-catch</h4><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            i = <span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            i = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Code:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=1, <span class="title">locals</span>=3, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">iconst_0</span></span></span><br><span class="line"><span class="function">         1: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         2: <span class="title">bipush</span>        10</span></span><br><span class="line"><span class="function">         4: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         5: <span class="title">goto</span>          12</span></span><br><span class="line"><span class="function">         8: <span class="title">astore_2</span></span></span><br><span class="line"><span class="function">         9: <span class="title">bipush</span>        20</span></span><br><span class="line"><span class="function">        11: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        12: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">Exception</span> <span class="title">table</span>:</span></span><br><span class="line"><span class="function">         <span class="title">from</span>    <span class="title">to</span>  <span class="title">target</span> <span class="title">type</span></span></span><br><span class="line"><span class="function">             2     5     8   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Exception</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 10: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 12: 2</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 15: 5</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 13: 8</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 14: 9</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 16: 12</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            9       3     2     <span class="title">e</span>   <span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">Exception</span>;</span></span><br><span class="line"><span class="function">            0      13     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">            2      11     1     <span class="title">i</span>   <span class="title">I</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以看到多出来一个 Exception table 的结构, [from, to) 是前闭后开(也就是检测 2~4 行)的检测范围, 一旦这个范围内的字节码执行出现异常, 则通过 type 匹配异常类型, 如果一致, 进入 target 所指示行号</li>
<li>8 行的字节码指令 astore_2 是将异常对象引用存入局部变量表的 2 号位置(为 e )</li>
</ul>
<h4 id="多个-single-catch"><a href="#多个-single-catch" class="headerlink" title="多个 single-catch"></a>多个 single-catch</h4><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            i = <span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (ArithmeticException e) &#123;</span><br><span class="line">            i = <span class="number">20</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            i = <span class="number">30</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Code:</span></span><br><span class="line"><span class="function">      <span class="title">stack</span>=1, <span class="title">locals</span>=3, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">iconst_0</span></span></span><br><span class="line"><span class="function">         1: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         2: <span class="title">bipush</span>        10</span></span><br><span class="line"><span class="function">         4: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">         5: <span class="title">goto</span>          19</span></span><br><span class="line"><span class="function">         8: <span class="title">astore_2</span></span></span><br><span class="line"><span class="function">         9: <span class="title">bipush</span>        20</span></span><br><span class="line"><span class="function">        11: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        12: <span class="title">goto</span>          19</span></span><br><span class="line"><span class="function">        15: <span class="title">astore_2</span></span></span><br><span class="line"><span class="function">        16: <span class="title">bipush</span>        30</span></span><br><span class="line"><span class="function">        18: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        19: <span class="title">return</span></span></span><br><span class="line"><span class="function">      <span class="title">Exception</span> <span class="title">table</span>:</span></span><br><span class="line"><span class="function">         <span class="title">from</span>    <span class="title">to</span>  <span class="title">target</span> <span class="title">type</span></span></span><br><span class="line"><span class="function">             2     5     8   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">ArithmeticException</span></span></span><br><span class="line"><span class="function">             2     5    15   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Exception</span></span></span><br><span class="line"><span class="function">      <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 10: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 12: 2</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 17: 5</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 13: 8</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 14: 9</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 17: 12</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 15: 15</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 16: 16</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 18: 19</span></span><br><span class="line"><span class="function">      <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">            9       3     2     <span class="title">e</span>   <span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">ArithmeticException</span>;</span></span><br><span class="line"><span class="function">           16       3     2     <span class="title">e</span>   <span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">Exception</span>;</span></span><br><span class="line"><span class="function">            0      20     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">            2      18     1     <span class="title">i</span>   <span class="title">I</span></span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>

<ul>
<li>因为异常出现时, 只能进入 Exception table 中一个分支, 所以局部变量表 slot 2 位置被共用</li>
</ul>
<h4 id="multi-catch-的情况"><a href="#multi-catch-的情况" class="headerlink" title="multi-catch 的情况"></a>multi-catch 的情况</h4><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            i = <span class="number">10</span>;</span><br><span class="line">        &#125;<span class="keyword">catch</span> (NoSuchMethodException | IllegalAccessException | InvocationTargetException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Code:</span></span><br><span class="line"><span class="function">     <span class="title">stack</span>=3, <span class="title">locals</span>=2, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">         0: <span class="title">ldc</span>           #2                  // <span class="title">class</span> <span class="title">com</span>/<span class="title">ayu3</span>/<span class="title">Demo</span></span></span><br><span class="line"><span class="function">         2: <span class="title">ldc</span>           #3                  // <span class="title">String</span> <span class="title">test</span></span></span><br><span class="line"><span class="function">         4: <span class="title">iconst_0</span></span></span><br><span class="line"><span class="function">         5: <span class="title">anewarray</span>     #4                  // <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Class</span></span></span><br><span class="line"><span class="function">         8: <span class="title">invokevirtual</span> #5                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Class.getMethod</span>:(<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;[<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">Class</span>;)<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">reflect</span>/<span class="title">Method</span>;</span></span><br><span class="line"><span class="function">        11: <span class="title">astore_1</span></span></span><br><span class="line"><span class="function">        12: <span class="title">aload_1</span></span></span><br><span class="line"><span class="function">        13: <span class="title">aconst_null</span></span></span><br><span class="line"><span class="function">        14: <span class="title">iconst_0</span></span></span><br><span class="line"><span class="function">        15: <span class="title">anewarray</span>     #6                  // <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Object</span></span></span><br><span class="line"><span class="function">        18: <span class="title">invokevirtual</span> #7                  // <span class="title">Method</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">reflect</span>/<span class="title">Method.invoke</span>:(<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">Object</span>;[<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">Object</span>;)<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">Object</span>;</span></span><br><span class="line"><span class="function">        21: <span class="title">pop</span></span></span><br><span class="line"><span class="function">        22: <span class="title">goto</span>          30</span></span><br><span class="line"><span class="function">        25: <span class="title">astore_1</span></span></span><br><span class="line"><span class="function">        26: <span class="title">aload_1</span></span></span><br><span class="line"><span class="function">        27: <span class="title">invokevirtual</span> #11                 // <span class="title">Method</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">ReflectiveOperationException.printStackTrace</span>:()<span class="title">V</span></span></span><br><span class="line"><span class="function">        30: <span class="title">return</span></span></span><br><span class="line"><span class="function">     <span class="title">Exception</span> <span class="title">table</span>:</span></span><br><span class="line"><span class="function">         <span class="title">from</span>    <span class="title">to</span>  <span class="title">target</span> <span class="title">type</span></span></span><br><span class="line"><span class="function">             0    22    25   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">NoSuchMethodException</span></span></span><br><span class="line"><span class="function">             0    22    25   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">IllegalAccessException</span></span></span><br><span class="line"><span class="function">             0    22    25   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">reflect</span>/<span class="title">InvocationTargetException</span></span></span><br><span class="line"><span class="function">     <span class="title">LineNumberTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 14: 0</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 15: 12</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 18: 22</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 16: 25</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 17: 26</span></span><br><span class="line"><span class="function">        <span class="title">line</span> 19: 30</span></span><br><span class="line"><span class="function">     <span class="title">LocalVariableTable</span>:</span></span><br><span class="line"><span class="function">        <span class="title">Start</span>  <span class="title">Length</span>  <span class="title">Slot</span>  <span class="title">Name</span>   <span class="title">Signature</span></span></span><br><span class="line"><span class="function">           12      10     1  <span class="title">test</span>   <span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">reflect</span>/<span class="title">Method</span>;</span></span><br><span class="line"><span class="function">           26       4     1     <span class="title">e</span>   <span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">ReflectiveOperationException</span>;</span></span><br><span class="line"><span class="function">            0      31     0  <span class="title">args</span>   [<span class="title">Ljava</span>/<span class="title">lang</span>/<span class="title">String</span>;</span></span><br><span class="line"><span class="function">      <span class="title">StackMapTable</span>: <span class="title">number_of_entries</span> = 2</span></span><br><span class="line"><span class="function">        <span class="title">frame_type</span> = 89 /* <span class="title">same_locals_1_stack_item</span> */</span></span><br><span class="line"><span class="function">          <span class="title">stack</span> = [ <span class="title">class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">ReflectiveOperationException</span> ]</span></span><br><span class="line"><span class="function">        <span class="title">frame_type</span> = 4 /* <span class="title">same</span> */</span></span><br></pre></td></tr></table></figure>

<ul>
<li>从字节码来看发现也就那么回事, 有异常发生了先在ExceptionTable进行对比, 然后跳转到25行</li>
</ul>
<h4 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h4><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            i = <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            i = <span class="number">20</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            i = <span class="number">30</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Code:</span></span><br><span class="line"><span class="function">     <span class="title">stack</span>=1, <span class="title">locals</span>=4, <span class="title">args_size</span>=1</span></span><br><span class="line"><span class="function">        0: <span class="title">iconst_0</span></span></span><br><span class="line"><span class="function">        1: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        // <span class="title">try</span>块</span></span><br><span class="line"><span class="function">        2: <span class="title">bipush</span>        10</span></span><br><span class="line"><span class="function">        4: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        // <span class="title">try</span>块执行完后, 会执行<span class="title">finally</span>    </span></span><br><span class="line"><span class="function">        5: <span class="title">bipush</span>        30</span></span><br><span class="line"><span class="function">        7: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">        8: <span class="title">goto</span>          27</span></span><br><span class="line"><span class="function">       // <span class="title">catch</span>块     </span></span><br><span class="line"><span class="function">       11: <span class="title">astore_2</span> // 异常信息放入局部变量表的2号槽位</span></span><br><span class="line"><span class="function">       12: <span class="title">bipush</span>        20</span></span><br><span class="line"><span class="function">       14: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">       // <span class="title">catch</span>块执行完后, 会执行<span class="title">finally</span>        </span></span><br><span class="line"><span class="function">       15: <span class="title">bipush</span>        30</span></span><br><span class="line"><span class="function">       17: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">       18: <span class="title">goto</span>          27</span></span><br><span class="line"><span class="function">       // 出现异常, 但未被 <span class="title">Exception</span> 捕获, 会抛出其他异常, 这时也需要执行 <span class="title">finally</span> 块中的代码   </span></span><br><span class="line"><span class="function">       21: <span class="title">astore_3</span></span></span><br><span class="line"><span class="function">       22: <span class="title">bipush</span>        30</span></span><br><span class="line"><span class="function">       24: <span class="title">istore_1</span></span></span><br><span class="line"><span class="function">       25: <span class="title">aload_3</span></span></span><br><span class="line"><span class="function">       26: <span class="title">athrow</span>  // 抛出异常</span></span><br><span class="line"><span class="function">       27: <span class="title">return</span></span></span><br><span class="line"><span class="function">     <span class="title">Exception</span> <span class="title">table</span>:</span></span><br><span class="line"><span class="function">        <span class="title">from</span>    <span class="title">to</span>  <span class="title">target</span> <span class="title">type</span></span></span><br><span class="line"><span class="function">            2     5    11   <span class="title">Class</span> <span class="title">java</span>/<span class="title">lang</span>/<span class="title">Exception</span></span></span><br><span class="line"><span class="function">            2     5    21   <span class="title">any</span></span></span><br><span class="line"><span class="function">           11    15    21   <span class="title">any</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>可以看到 ﬁnally 中的代码被复制了 3 份, 分别放入 try 流程, catch 流程以及 catch 剩余的异常类型流程</li>
<li>虽然从字节码指令看来, 每个块中都有 finally 块, 但是 finally 块中的代码只会被执行一次</li>
</ul>
<h4 id="finally-中的-return"><a href="#finally-中的-return" class="headerlink" title="finally 中的 return"></a>finally 中的 return</h4><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = test();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Code:</span></span><br><span class="line"><span class="function"><span class="title">stack</span>=1, <span class="title">locals</span>=2, <span class="title">args_size</span>=0</span></span><br><span class="line"><span class="function">0: <span class="title">bipush</span> 10 // &lt;- 10 放入栈顶</span></span><br><span class="line"><span class="function">2: <span class="title">istore_0</span> // 10 -&gt; <span class="title">slot</span> 0 (从栈顶移除了)</span></span><br><span class="line"><span class="function">3: <span class="title">bipush</span> 20 // &lt;- 20 放入栈顶</span></span><br><span class="line"><span class="function">5: <span class="title">ireturn</span> // 返回栈顶 <span class="title">int</span>(20)</span></span><br><span class="line"><span class="function">6: <span class="title">astore_1</span> // <span class="title">catch</span> <span class="title">any</span> -&gt; <span class="title">slot</span> 1</span></span><br><span class="line"><span class="function">7: <span class="title">bipush</span> 20 // &lt;- 20 放入栈顶</span></span><br><span class="line"><span class="function">9: <span class="title">ireturn</span> // 返回栈顶 <span class="title">int</span>(20)</span></span><br><span class="line"><span class="function"><span class="title">Exception</span> <span class="title">table</span>:</span></span><br><span class="line"><span class="function"><span class="title">from</span> <span class="title">to</span> <span class="title">target</span> <span class="title">type</span></span></span><br><span class="line"><span class="function">0 3 6 <span class="title">any</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>由于 finally 中的 ireturn 被插入了所有可能的流程, 因此返回结果肯定以 finally 的为准 </li>
<li>至于字节码中第 2 行, 似乎没啥用, 且留个伏笔, 看下个例子 </li>
<li>跟上例中的 finally 相比, 发现没有 athrow 了, 这告诉我们: 如果在 finally 中出现了 return, 会吞掉异常, 可以试一下下面的代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> result = test();</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">10</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会发现打印结果为 20 , 并未抛出异常</p>
<h4 id="finally-不带-return"><a href="#finally-不带-return" class="headerlink" title="finally 不带 return"></a>finally 不带 return</h4><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> result = test();</span><br><span class="line">		System.out.println(result);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> i;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            i = <span class="number">20</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">     stack=<span class="number">1</span>, locals=<span class="number">3</span>, args_size=<span class="number">0</span></span><br><span class="line">        <span class="number">0</span>: bipush        <span class="number">10</span></span><br><span class="line">        <span class="number">2</span>: istore_0 <span class="comment">// 赋值给i 10</span></span><br><span class="line">        <span class="number">3</span>: iload_0	<span class="comment">// 加载到操作数栈顶</span></span><br><span class="line">        <span class="number">4</span>: istore_1 <span class="comment">// 加载到局部变量表的1号位置</span></span><br><span class="line">        <span class="number">5</span>: bipush        <span class="number">20</span></span><br><span class="line">        <span class="number">7</span>: istore_0 <span class="comment">// 赋值给i 20</span></span><br><span class="line">        <span class="number">8</span>: iload_1 <span class="comment">// 加载局部变量表1号位置的数10到操作数栈</span></span><br><span class="line">        <span class="number">9</span>: ireturn <span class="comment">// 返回操作数栈顶元素 10</span></span><br><span class="line">       <span class="number">10</span>: astore_2</span><br><span class="line">       <span class="number">11</span>: bipush        <span class="number">20</span></span><br><span class="line">       <span class="number">13</span>: istore_0</span><br><span class="line">       <span class="number">14</span>: aload_2 <span class="comment">// 加载异常</span></span><br><span class="line">       <span class="number">15</span>: athrow <span class="comment">// 抛出异常</span></span><br><span class="line">     Exception table:</span><br><span class="line">        from    to  target type</span><br><span class="line">            <span class="number">3</span>     <span class="number">5</span>    <span class="number">10</span>   any</span><br></pre></td></tr></table></figure>

<h3 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h3><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Object lock = <span class="keyword">new</span> Object();</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ok&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>字节码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">      stack=<span class="number">2</span>, locals=<span class="number">4</span>, args_size=<span class="number">1</span></span><br><span class="line">         <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/lang/Object</span></span><br><span class="line">         <span class="number">3</span>: dup <span class="comment">//复制一份栈顶, 然后压入栈中, 用于执行构造方法</span></span><br><span class="line">         <span class="number">4</span>: invokespecial #<span class="number">1</span>                  <span class="comment">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">         <span class="number">7</span>: astore_1 <span class="comment">//lock引用赋值给lock对象</span></span><br><span class="line">         <span class="number">8</span>: aload_1 <span class="comment">//将对象加载到操作数栈</span></span><br><span class="line">         <span class="number">9</span>: dup <span class="comment">//将这个对象再复制一份</span></span><br><span class="line">        <span class="number">10</span>: astore_2 <span class="comment">//将复制好的对象存入2号槽位</span></span><br><span class="line">        <span class="number">11</span>: monitorenter <span class="comment">//将栈顶的对象交给monitorenter, 也就是对lock加锁</span></span><br><span class="line">        <span class="number">12</span>: getstatic     #<span class="number">3</span>                  <span class="comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span><br><span class="line">        <span class="number">15</span>: ldc           #<span class="number">4</span>                  <span class="comment">// String ok</span></span><br><span class="line">        <span class="number">17</span>: invokevirtual #<span class="number">5</span>                  <span class="comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span><br><span class="line">        <span class="number">20</span>: aload_2 <span class="comment">//将2号槽位的lock对象加载到操作数栈</span></span><br><span class="line">        <span class="number">21</span>: monitorexit <span class="comment">//使用monitorexit解锁</span></span><br><span class="line">        <span class="number">22</span>: goto          <span class="number">30</span></span><br><span class="line">        <span class="comment">//发生异常</span></span><br><span class="line">        <span class="number">25</span>: astore_3 <span class="comment">//将异常对象存入3号槽位</span></span><br><span class="line">        <span class="number">26</span>: aload_2</span><br><span class="line">        <span class="number">27</span>: monitorexit</span><br><span class="line">        <span class="number">28</span>: aload_3 <span class="comment">//将异常对象加载到操作数栈</span></span><br><span class="line">        <span class="number">29</span>: athrow <span class="comment">//抛出异常</span></span><br><span class="line">        <span class="number">30</span>: <span class="keyword">return</span></span><br><span class="line">      Exception table:</span><br><span class="line">         from    to  target type</span><br><span class="line">            <span class="number">12</span>    <span class="number">22</span>    <span class="number">25</span>   any</span><br><span class="line">            <span class="number">25</span>    <span class="number">28</span>    <span class="number">25</span>   any</span><br><span class="line">      LineNumberTable:</span><br><span class="line">        line <span class="number">13</span>: <span class="number">0</span></span><br><span class="line">        line <span class="number">14</span>: <span class="number">8</span></span><br><span class="line">        line <span class="number">15</span>: <span class="number">12</span></span><br><span class="line">        line <span class="number">16</span>: <span class="number">20</span></span><br><span class="line">        line <span class="number">17</span>: <span class="number">30</span></span><br><span class="line">      LocalVariableTable:</span><br><span class="line">        Start  Length  Slot  Name   Signature</span><br><span class="line">            <span class="number">0</span>      <span class="number">31</span>     <span class="number">0</span>  args   [Ljava/lang/String;</span><br><span class="line">            <span class="number">8</span>      <span class="number">23</span>     <span class="number">1</span>  lock   Ljava/lang/Object;</span><br></pre></td></tr></table></figure>

<h2 id="3-编译期处理"><a href="#3-编译期处理" class="headerlink" title="3. 编译期处理"></a>3. 编译期处理</h2><p>所谓的<strong>语法糖</strong> , 其实就是指 java 编译器把 *.java 源码编译为 *.class 字节码的过程中, 自动生成 和转换的一些代码, 主要是为了减轻程序员的负担, 算是 java 编译器给我们的一个额外福利（给糖吃嘛） </p>
<p>注意, 以下代码的分析, 借助了 javap 工具, idea 的反编译功能, idea 插件 jclasslib 等工具。另外,  编译器转换的结果直接就是 class 字节码, 只是为了便于阅读, 给出了<strong>几乎等价</strong>的 java 源码方式, 并 不是编译器还会转换出中间的 java 源码, 切记。</p>
<h3 id="默认构造器"><a href="#默认构造器" class="headerlink" title="默认构造器"></a>默认构造器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>经过编译期优化后:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">   <span class="comment">// 这个无参构造器是java编译器帮我们加上的</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">Candy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 即调用父类 Object 的无参构造方法, 即调用 java/lang/Object.&quot; &lt;init&gt;&quot;:()V</span></span><br><span class="line">      <span class="keyword">super</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动拆装箱"><a href="#自动拆装箱" class="headerlink" title="自动拆装箱"></a>自动拆装箱</h3><p>这个特性是 JDK 5 开始加入的, 代码片段1: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer x = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> y = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这段代码在 JDK 5 之前是无法编译通过的, 必须改写为 代码片段2: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Integer x = Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">int</span> y = x.intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>显然之前版本的代码太麻烦了, 需要在基本类型和包装类型之间来回转换(尤其是集合类中操作的都是包装类型), 因此这些转换的事情在 JDK 5 以后都由编译器在编译阶段完成。即<strong>代码片段1</strong>都会在编 译阶段被转换为<strong>代码片段2</strong></p>
<h3 id="泛型集合取值"><a href="#泛型集合取值" class="headerlink" title="泛型集合取值"></a>泛型集合取值</h3><p>泛型也是在 JDK 5 开始加入的特性, 但 java 在编译泛型代码后会执行<strong>泛型擦除</strong>的动作, 即泛型信息在编译为字节码之后就丢失了, 实际的类型都当做了 Object 类型来处理:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">10</span>); <span class="comment">// 实际调用的是 List.add(Object e)</span></span><br><span class="line">        Integer x = list.get(<span class="number">0</span>); <span class="comment">// 实际调用的是 Object obj = List.get(int index);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以在取值时, 编译器真正生成的字节码中, 还要额外做一个类型转换的操作: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要将 Object 转为 Integer</span></span><br><span class="line">Integer x = (Integer)list.get(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>如果前面的 x 变量类型修改为 int 基本类型那么最终生成的字节码是:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 需要将 Object 转为 Integer, 并执行拆箱操作</span></span><br><span class="line"><span class="keyword">int</span> x = ((Integer)list.get(<span class="number">0</span>)).intValue();</span><br></pre></td></tr></table></figure>

<p>对应字节码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Code:</span><br><span class="line">    stack=<span class="number">2</span>, locals=<span class="number">3</span>, args_size=<span class="number">1</span></span><br><span class="line">       <span class="number">0</span>: <span class="keyword">new</span>           #<span class="number">2</span>                  <span class="comment">// class java/util/ArrayList</span></span><br><span class="line">       <span class="number">3</span>: dup</span><br><span class="line">       <span class="number">4</span>: invokespecial #<span class="number">3</span>                  <span class="comment">// Method java/util/ArrayList.&quot;&lt;init&gt;&quot;:()V</span></span><br><span class="line">       <span class="number">7</span>: astore_1</span><br><span class="line">       <span class="number">8</span>: aload_1</span><br><span class="line">       <span class="number">9</span>: bipush        <span class="number">10</span></span><br><span class="line">      <span class="number">11</span>: invokestatic  #<span class="number">4</span>                  <span class="comment">// Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span></span><br><span class="line">      <span class="comment">// 这里进行了泛型擦除java实际调用的是add(Objcet o)</span></span><br><span class="line">      <span class="number">14</span>: invokeinterface #<span class="number">5</span>,  <span class="number">2</span>            <span class="comment">// InterfaceMethod java/util/List.add:(Ljava/lang/Object;)Z</span></span><br><span class="line">      <span class="number">19</span>: pop</span><br><span class="line">      <span class="number">20</span>: aload_1</span><br><span class="line">      <span class="number">21</span>: iconst_0</span><br><span class="line">      <span class="comment">// 这里也进行了泛型擦除java实际调用的是get(Object o)   </span></span><br><span class="line">      <span class="number">22</span>: invokeinterface #<span class="number">6</span>,  <span class="number">2</span>            <span class="comment">// InterfaceMethod java/util/List.get:(I)Ljava/lang/Object;</span></span><br><span class="line"><span class="comment">// 这里进行了类型转换java将 Object 转换成了 Integer</span></span><br><span class="line">      <span class="number">27</span>: checkcast     #<span class="number">7</span>                  <span class="comment">// class java/lang/Integer</span></span><br><span class="line">      <span class="number">30</span>: astore_2</span><br><span class="line">      <span class="number">31</span>: <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p>使用反射可以得到, 参数的类型以及泛型类型: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException </span>&#123;</span><br><span class="line">    <span class="comment">// 1. 拿到方法</span></span><br><span class="line">    Method method = Candy.class.getMethod(<span class="string">&quot;test&quot;</span>, List.class, Map.class);</span><br><span class="line">    <span class="comment">// 2. 得到泛型参数的类型信息</span></span><br><span class="line">    Type[] types = method.getGenericParameterTypes();</span><br><span class="line">    <span class="keyword">for</span>(Type type : types) &#123;</span><br><span class="line">        <span class="comment">// 3. 判断参数类型是否, 带泛型的类型。</span></span><br><span class="line">        <span class="keyword">if</span>(type <span class="keyword">instanceof</span> ParameterizedType) &#123;</span><br><span class="line">            ParameterizedType parameterizedType = (ParameterizedType) type;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 得到原始类型</span></span><br><span class="line">            System.out.println(<span class="string">&quot;原始类型 - &quot;</span> + parameterizedType.getRawType());</span><br><span class="line">            <span class="comment">// 5. 拿到泛型类型</span></span><br><span class="line">            Type[] arguments = parameterizedType.getActualTypeArguments();</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arguments.length; i++) &#123;</span><br><span class="line">                System.out.printf(<span class="string">&quot;泛型参数[%d] - %s\n&quot;</span>, i, arguments[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Set&lt;Integer&gt; <span class="title">test</span><span class="params">(List&lt;String&gt; list, Map&lt;Integer, Object&gt; map)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>打印结果:</p>
<blockquote>
<p>原始类型 - interface java.util.List<br>泛型参数[0] - class java.lang.String<br>原始类型 - interface java.util.Map<br>泛型参数[0] - class java.lang.Integer<br>泛型参数[1] - class java.lang.Object</p>
</blockquote>
<h3 id="可变参数"><a href="#可变参数" class="headerlink" title="可变参数"></a>可变参数</h3><p>可变参数也是 JDK 5 开始加入的新特性: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(String... args)</span> </span>&#123;</span><br><span class="line">        String[] array = args; <span class="comment">// 直接赋值</span></span><br><span class="line">        System.out.println(array);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        foo(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可变参数 <code>String... args</code> 其实是一个 <code>String[] args</code> , 从代码中的赋值语句中就可以看出来, 同样 java 编译器会在编译期间将上述代码变换为: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">foo</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String[] array = args; <span class="comment">// 直接赋值</span></span><br><span class="line">        System.out.println(array);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        foo(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong> </p>
<p>如果调用了 <code>foo()</code> 则等价代码为 <code>foo(new String[]&#123;&#125;)</code> , 创建了一个空的数组, 而不会传递 <code>null</code> 进去</p>
</blockquote>
<h3 id="foreach-循环"><a href="#foreach-循环" class="headerlink" title="foreach 循环"></a>foreach 循环</h3><p>仍是 JDK 5 开始引入的语法糖, 数组的循环: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 数组赋初值的简化写法也是一种语法糖。</span></span><br><span class="line">		<span class="keyword">int</span>[] arr = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> x : arr) &#123;</span><br><span class="line">			System.out.println(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器会帮我们转换为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Candy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span>[] arr = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; arr.length; ++i) &#123;</span><br><span class="line">			<span class="keyword">int</span> x = arr[i];</span><br><span class="line">			System.out.println(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果是集合使用 foreach: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (Integer x : list) &#123;</span><br><span class="line">            System.out.println(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器会帮我们转换为:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Candy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line">        Iterator var2 = list.iterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(var2.hasNext()) &#123;</span><br><span class="line">            Integer x = (Integer)var2.next();</span><br><span class="line">            System.out.println(x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong></p>
<p>集合要使用 foreach , 需要该集合类实现了 <strong>Iterable</strong> 接口, 因为集合的遍历需要用到迭代器 <strong>Iterator</strong></p>
</blockquote>
<h3 id="switch-字符串"><a href="#switch-字符串" class="headerlink" title="switch 字符串"></a>switch 字符串</h3><p>从 JDK 7 开始, switch 可以作用于字符串和枚举类, 这个功能其实也是语法糖, 例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cnady</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      String str = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">      <span class="keyword">switch</span> (str) &#123;</span><br><span class="line">         <span class="keyword">case</span> <span class="string">&quot;hello&quot;</span> :</span><br><span class="line">            System.out.println(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="string">&quot;world&quot;</span> :</span><br><span class="line">            System.out.println(<span class="string">&quot;w&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器帮我们转换成:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Candy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span> var3 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">switch</span>(str.hashCode()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">99162322</span>:</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">&quot;hello&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">113318802</span>:</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">&quot;world&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">switch</span>(var3) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            System.out.println(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            System.out.println(<span class="string">&quot;w&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到, 执行了两遍 switch, 第一遍是根据字符串的 hashCode 和 equals 将字符串的转换为相应 byte 类型, 第二遍才是利用 byte 执行进行比较。</p>
<p>为什么第一遍时必须既比较 hashCode, 又利用 equals 比较呢？hashCode 是为了提高效率, 减少可能的比较, 而 equals 是为了防止 hashCode 冲突, 例如 <code>BM</code> 和 <code>C.</code> 这两个字符串的hashCode值都是 <code>2123</code> , 如果有如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;BM&quot;</span>;</span><br><span class="line">        <span class="keyword">switch</span> (str) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;BM&quot;</span>: &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;C.&quot;</span>: &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;w&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译器帮我们转换成:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Candy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;BM&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span> var3 = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">switch</span>(str.hashCode()) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2123</span>:</span><br><span class="line">            <span class="keyword">if</span> (str.equals(<span class="string">&quot;C.&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (str.equals(<span class="string">&quot;BM&quot;</span>)) &#123;</span><br><span class="line">                var3 = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">switch</span>(var3) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;h&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                System.out.println(<span class="string">&quot;w&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong> </p>
<p>switch 配合 String 和枚举使用时, 变量不能为null, 原因就是null没有hash值</p>
</blockquote>
<h3 id="switch-枚举"><a href="#switch-枚举" class="headerlink" title="switch 枚举"></a>switch 枚举</h3><p>switch 枚举的例子, 原始代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">SEX</span> </span>&#123;</span><br><span class="line">    MALE, FEMALE;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SEX sex = SEX.MALE;</span><br><span class="line">        <span class="keyword">switch</span> (sex) &#123;</span><br><span class="line">            <span class="keyword">case</span> MALE:</span><br><span class="line">                System.out.println(<span class="string">&quot;man&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> FEMALE:</span><br><span class="line">                System.out.println(<span class="string">&quot;woman&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">   <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 定义一个合成类(仅 jvm 使用, 对我们不可见)</span></span><br><span class="line"><span class="comment">    * 用来映射枚举的 ordinal 与数组元素的关系     </span></span><br><span class="line"><span class="comment">    * 枚举的 ordinal 表示枚举对象的序号, 从 0 开始     </span></span><br><span class="line"><span class="comment">    * 即 MALE 的 ordinal()=0, FEMALE 的 ordinal()=1     </span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">   <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> $<span class="title">MAP</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 数组大小即为枚举元素个数, 里面存放了 case 用于比较的数字</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">int</span>[] map = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">2</span>];</span><br><span class="line">      <span class="keyword">static</span> &#123;</span><br><span class="line">         <span class="comment">// ordinal 即枚举元素对应所在的位置, MALE 为 0 , FEMALE 为 1</span></span><br><span class="line">         map[SEX.MALE.ordinal()] = <span class="number">1</span>;</span><br><span class="line">         map[SEX.FEMALE.ordinal()] = <span class="number">2</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      SEX sex = SEX.MALE;</span><br><span class="line">      <span class="comment">// 将对应位置枚举元素的值赋给 x , 用于 case 操作</span></span><br><span class="line">      <span class="keyword">int</span> x = $MAP.map[sex.ordinal()];</span><br><span class="line">      <span class="keyword">switch</span> (x) &#123;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            System.out.println(<span class="string">&quot;man&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            System.out.println(<span class="string">&quot;woman&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">         <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="枚举类"><a href="#枚举类" class="headerlink" title="枚举类"></a>枚举类</h3><p>JDK 7 新增了枚举类, 以前面的性别枚举为例:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">SEX</span> </span>&#123;</span><br><span class="line">   MALE, FEMALE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后的代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Sex</span> <span class="keyword">extends</span> <span class="title">Enum</span>&lt;<span class="title">Sex</span>&gt; </span>&#123;   </span><br><span class="line">   <span class="comment">// 对应枚举类中的元素</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex MALE;    </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex FEMALE;    </span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Sex[] $VALUES;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">static</span> &#123;       </span><br><span class="line">    	<span class="comment">// 调用构造函数, 传入枚举元素的值及 ordinal</span></span><br><span class="line">    	MALE = <span class="keyword">new</span> Sex(<span class="string">&quot;MALE&quot;</span>, <span class="number">0</span>);    </span><br><span class="line">        FEMALE = <span class="keyword">new</span> Sex(<span class="string">&quot;FEMALE&quot;</span>, <span class="number">1</span>);   </span><br><span class="line">        $VALUES = <span class="keyword">new</span> Sex[]&#123;MALE, FEMALE&#125;; </span><br><span class="line">   &#125;</span><br><span class="line"> 	</span><br><span class="line">   <span class="comment">// 调用父类中的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Sex</span><span class="params">(String name, <span class="keyword">int</span> ordinal)</span> </span>&#123;     </span><br><span class="line">        <span class="keyword">super</span>(name, ordinal);    </span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Sex[] values() &#123;  </span><br><span class="line">        <span class="keyword">return</span> $VALUES.clone();  </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Sex <span class="title">valueOf</span><span class="params">(String name)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">return</span> Enum.valueOf(Sex.class, name);  </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="try-with-resources"><a href="#try-with-resources" class="headerlink" title="try-with-resources"></a>try-with-resources</h3><p>JDK 7 开始新增了对需要关闭的资源处理的特殊语法 try-with-resources：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>(资源变量 = 创建资源对象) &#123;</span><br><span class="line">	</span><br><span class="line">&#125; <span class="keyword">catch</span>() &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中资源对象需要实现 AutoCloseable 接口, 例如 InputStream 、 OutputStream 、 Connection 、 Statement 、 ResultSet 等接口都实现了 AutoCloseable , 使用 try-with- resources 可以不用写 finally 语句块, 编译器会帮助生成关闭资源代码, 例如: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span>(InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;./1.txt&quot;</span>)) &#123;</span><br><span class="line">            System.out.println(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会被转换成:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Candy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            InputStream is = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;./1.txt&quot;</span>);</span><br><span class="line">            Throwable t = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(is);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e1) &#123; </span><br><span class="line">                <span class="comment">// t 是我们代码出现的异常 </span></span><br><span class="line">                t = e1; </span><br><span class="line">                <span class="keyword">throw</span> e1; </span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="comment">// 判断了资源不为空 </span></span><br><span class="line">                <span class="keyword">if</span> (is != <span class="keyword">null</span>) &#123; </span><br><span class="line">                    <span class="comment">// 如果我们代码有异常</span></span><br><span class="line">                    <span class="keyword">if</span> (t != <span class="keyword">null</span>) &#123; </span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            is.close(); </span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable e2) &#123; </span><br><span class="line">                            <span class="comment">// 如果 close 出现异常, 作为被压制异常添加</span></span><br><span class="line">                            t.addSuppressed(e2); </span><br><span class="line">                        &#125; </span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">                        <span class="comment">// 如果我们代码没有异常, close 出现的异常就是最后 catch 块中的 e </span></span><br><span class="line">                        is.close(); </span><br><span class="line">                    &#125; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125; </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为什么要设计一个 <code>addSuppressed(Throwable e)</code> (添加被压制异常)的方法呢？是为了防止异常信息的丢失(想想 try-with-resources 生成的 fianlly 中如果抛出了异常): </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">		<span class="keyword">try</span> (MyResource resource = <span class="keyword">new</span> MyResource()) &#123; </span><br><span class="line">			<span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>; </span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123; </span><br><span class="line">			e.printStackTrace(); </span><br><span class="line">		&#125; </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyResource</span> <span class="keyword">implements</span> <span class="title">AutoCloseable</span> </span>&#123; </span><br><span class="line">    <span class="comment">//关闭时抛出一个异常, 测试是否丢失</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;close 异常&quot;</span>); </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出:</p>
<blockquote>
<p>java.lang.ArithmeticException: / by zero<br>    at test.Test6.main(Test6.java:7)<br>    Suppressed: java.lang.Exception: close 异常<br>        at test.MyResource.close(Test6.java:18)<br>        at test.Test6.main(Test6.java:6)</p>
</blockquote>
<p>如以上代码所示, 两个异常信息都不会丢。</p>
<h3 id="方法重写时的桥接方法"><a href="#方法重写时的桥接方法" class="headerlink" title="方法重写时的桥接方法"></a>方法重写时的桥接方法</h3><p>我们都知道, 方法重写时对返回值分两种情况: </p>
<ul>
<li>父子类的返回值完全一致</li>
<li>子类返回值可以是父类返回值的子类(见下面例子)</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Number <span class="title">m</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>; </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123; </span><br><span class="line">	<span class="meta">@Override</span> </span><br><span class="line">	<span class="comment">// 子类 m 方法的返回值是 Integer 是父类 m 方法返回值 Number 的子类 	</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">m</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>; </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于子类, 编译器转换成:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> <span class="keyword">extends</span> <span class="title">A</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> Integer <span class="title">m</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 此方法才是真正重写了父类 public Number m() 方法 </span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> synthetic bridge Number <span class="title">m</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		<span class="comment">// 调用 public Integer m() </span></span><br><span class="line">		<span class="keyword">return</span> m(); </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中桥接方法比较特殊, 仅对 java 虚拟机可见, 并且与原来的 <code>public Integer m()</code> 没有命名冲突, 可以用下面反射代码来验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(Method m : B.class.getDeclaredMethods()) &#123;</span><br><span class="line">    System.out.println(m);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果:</p>
<blockquote>
<p>public java.lang.Integer com.ayu3.B.m()<br>public java.lang.Number com.ayu3.B.m()</p>
</blockquote>
<h3 id="匿名内部类"><a href="#匿名内部类" class="headerlink" title="匿名内部类"></a>匿名内部类</h3><p>源码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      Runnable runnable = <span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">         &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后的代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// 用额外创建的类来创建匿名内部类对象</span></span><br><span class="line">      Runnable runnable = <span class="keyword">new</span> Candy10$<span class="number">1</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建了一个额外的类, 实现了 Runnable 接口</span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span>$1 <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> Candy$<span class="number">1</span>() &#123;&#125;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      System.out.println(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>引用局部变量的匿名内部类, 源代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> x)</span> </span>&#123; </span><br><span class="line">		Runnable runnable = <span class="keyword">new</span> Runnable() &#123; </span><br><span class="line">			<span class="meta">@Override</span> </span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; 	</span><br><span class="line">				System.out.println(<span class="string">&quot;ok:&quot;</span> + x); </span><br><span class="line">			&#125; </span><br><span class="line">		&#125;; </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>转换后代码: </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 额外生成的类 </span></span><br><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span>$1 <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123; </span><br><span class="line">	<span class="keyword">int</span> val$x; </span><br><span class="line">	Candy$<span class="number">1</span>(<span class="keyword">int</span> x) &#123; </span><br><span class="line">		<span class="keyword">this</span>.val$x = x; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">		System.out.println(<span class="string">&quot;ok:&quot;</span> + <span class="keyword">this</span>.val$x); </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Candy</span> </span>&#123; </span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> x)</span> </span>&#123; </span><br><span class="line">		Runnable runnable = <span class="keyword">new</span> Candy11$<span class="number">1</span>(x); </span><br><span class="line">	&#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong></p>
<p>匿名内部类将这个局部变量的传入到匿名内部类中, 以成员变量的形式存在, 值传递有构造函数完成, 保存线程安全</p>
<p>为了避免方法内的变量脱离方法而存在的现象发生, 于是在jdk1.8之前java规定局部内部类不能访问一般的局部变量, 但能访问被final修饰的局部变量。</p>
<p>而在jdk1.8后就不需要手动添加final修饰局部变量, jvm会自动在底层添加final修饰符, 被称为effectively final</p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">aYu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://www.ayu.link/2022/05/03/JVM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/">http://www.ayu.link/2022/05/03/JVM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://www.ayu.link" target="_blank">aYuのblog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java-JVM/">Java,JVM</a></div><div class="post_share"><div class="social-share" data-image="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/04/26/JVM%E4%B9%8B%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/"><img class="next-cover" src="/img/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/wallhaven-v9rr2p.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM之垃圾回收</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/head.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">aYu</div><div class="author-info__description"></div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">21</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>公告</span></div><div class="announcement_content">I'm OK!<div class="twopeople"><div class="twopeople"><div class="container"style="height:50px;"><canvas class="illo"width="800"height="800"style="max-width: 200px; max-height: 200px; touch-action: none; width: 640px; height: 640px;"></canvas></div><script src="https://cdn.guole.fun/js/twopeople1.js"></script><script src="https://cdn.guole.fun/js/zdog.dist.js"></script><script id="rendered-js"src="https://cdn.guole.fun/js/twopeople.js"></script><style>.twopeople{margin:0;align-items:center;justify-content:center;text-align:center}canvas{display:block;margin:0 auto;cursor:move}</style></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF"><span class="toc-number">1.</span> <span class="toc-text">字节码技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%B1%BB%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">1. 类文件结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AD%94%E6%95%B0"><span class="toc-number">1.1.1.</span> <span class="toc-text">魔数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%88%E6%9C%AC"><span class="toc-number">1.1.2.</span> <span class="toc-text">版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.1.3.</span> <span class="toc-text">常量池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%A0%87%E8%AF%86%E4%B8%8E%E7%BB%A7%E6%89%BF%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.4.</span> <span class="toc-text">访问标识与继承信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Field-%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.5.</span> <span class="toc-text">Field 信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Method-%E4%BF%A1%E6%81%AF"><span class="toc-number">1.1.6.</span> <span class="toc-text">Method 信息</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">2. 字节码指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#javap%E5%B7%A5%E5%85%B7"><span class="toc-number">1.2.1.</span> <span class="toc-text">javap工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E8%A7%A3%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">图解方法执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.3.</span> <span class="toc-text">原始代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.4.</span> <span class="toc-text">编译后的字节码文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0%E8%BD%BD%E5%85%A5%E8%BF%90%E8%A1%8C%E6%97%B6%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="toc-number">1.2.5.</span> <span class="toc-text">常量池载入运行时常量池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%AD%97%E8%8A%82%E7%A0%81%E8%BD%BD%E5%85%A5%E6%96%B9%E6%B3%95%E5%8C%BA"><span class="toc-number">1.2.6.</span> <span class="toc-text">方法字节码载入方法区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-%E7%BA%BF%E7%A8%8B%E5%BC%80%E5%A7%8B%E8%BF%90%E8%A1%8C-%E5%88%86%E9%85%8D%E6%A0%88%E5%B8%A7%E5%86%85%E5%AD%98"><span class="toc-number">1.2.7.</span> <span class="toc-text">main 线程开始运行, 分配栈帧内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C%E5%AD%97%E8%8A%82%E7%A0%81"><span class="toc-number">1.2.8.</span> <span class="toc-text">执行引擎开始执行字节码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90a"><span class="toc-number">1.2.9.</span> <span class="toc-text">分析a++</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E6%8C%87%E4%BB%A4"><span class="toc-number">1.2.10.</span> <span class="toc-text">条件判断指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E6%8E%A7%E5%88%B6%E6%8C%87%E4%BB%A4"><span class="toc-number">1.2.11.</span> <span class="toc-text">循环控制指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E5%AD%97%E8%8A%82%E7%A0%81%E6%8C%87%E4%BB%A4%E5%88%86%E6%9E%90%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.12.</span> <span class="toc-text">通过字节码指令分析问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95"><span class="toc-number">1.2.13.</span> <span class="toc-text">构造方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%B0%83%E7%94%A8"><span class="toc-number">1.2.14.</span> <span class="toc-text">方法调用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%80%81%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.15.</span> <span class="toc-text">多态原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">1.2.16.</span> <span class="toc-text">异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#try-catch"><span class="toc-number">1.2.16.1.</span> <span class="toc-text">try-catch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA-single-catch"><span class="toc-number">1.2.16.2.</span> <span class="toc-text">多个 single-catch</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#multi-catch-%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">1.2.16.3.</span> <span class="toc-text">multi-catch 的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#finally"><span class="toc-number">1.2.16.4.</span> <span class="toc-text">finally</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#finally-%E4%B8%AD%E7%9A%84-return"><span class="toc-number">1.2.16.5.</span> <span class="toc-text">finally 中的 return</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#finally-%E4%B8%8D%E5%B8%A6-return"><span class="toc-number">1.2.16.6.</span> <span class="toc-text">finally 不带 return</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronized"><span class="toc-number">1.2.17.</span> <span class="toc-text">synchronized</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BC%96%E8%AF%91%E6%9C%9F%E5%A4%84%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">3. 编译期处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E6%9E%84%E9%80%A0%E5%99%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">默认构造器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E6%8B%86%E8%A3%85%E7%AE%B1"><span class="toc-number">1.3.2.</span> <span class="toc-text">自动拆装箱</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E9%9B%86%E5%90%88%E5%8F%96%E5%80%BC"><span class="toc-number">1.3.3.</span> <span class="toc-text">泛型集合取值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E5%8F%98%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.4.</span> <span class="toc-text">可变参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#foreach-%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.3.5.</span> <span class="toc-text">foreach 循环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#switch-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.3.6.</span> <span class="toc-text">switch 字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#switch-%E6%9E%9A%E4%B8%BE"><span class="toc-number">1.3.7.</span> <span class="toc-text">switch 枚举</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB"><span class="toc-number">1.3.8.</span> <span class="toc-text">枚举类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#try-with-resources"><span class="toc-number">1.3.9.</span> <span class="toc-text">try-with-resources</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E9%87%8D%E5%86%99%E6%97%B6%E7%9A%84%E6%A1%A5%E6%8E%A5%E6%96%B9%E6%B3%95"><span class="toc-number">1.3.10.</span> <span class="toc-text">方法重写时的桥接方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E5%86%85%E9%83%A8%E7%B1%BB"><span class="toc-number">1.3.11.</span> <span class="toc-text">匿名内部类</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/05/03/JVM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/" title="JVM之字节码技术"><img src="/img/%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM之字节码技术"/></a><div class="content"><a class="title" href="/2022/05/03/JVM%E5%AD%97%E8%8A%82%E7%A0%81%E6%8A%80%E6%9C%AF/" title="JVM之字节码技术">JVM之字节码技术</a><time datetime="2022-05-03T13:35:21.000Z" title="发表于 2022-05-03 21:35:21">2022-05-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/26/JVM%E4%B9%8B%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" title="JVM之垃圾回收"><img src="/img/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/wallhaven-v9rr2p.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM之垃圾回收"/></a><div class="content"><a class="title" href="/2022/04/26/JVM%E4%B9%8B%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/" title="JVM之垃圾回收">JVM之垃圾回收</a><time datetime="2022-04-26T13:34:00.000Z" title="发表于 2022-04-26 21:34:00">2022-04-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/15/JVM%E4%B9%8B%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" title="JVM之内存结构"><img src="/img/JVM/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM之内存结构"/></a><div class="content"><a class="title" href="/2022/04/15/JVM%E4%B9%8B%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84/" title="JVM之内存结构">JVM之内存结构</a><time datetime="2022-04-15T11:49:14.000Z" title="发表于 2022-04-15 19:49:14">2022-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/15/JVM%E4%B9%8B%E5%88%9D%E8%AF%86JVM/" title="JVM之初识JVM"><img src="/img/JVM/1.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JVM之初识JVM"/></a><div class="content"><a class="title" href="/2022/04/15/JVM%E4%B9%8B%E5%88%9D%E8%AF%86JVM/" title="JVM之初识JVM">JVM之初识JVM</a><time datetime="2022-04-15T11:49:03.000Z" title="发表于 2022-04-15 19:49:03">2022-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/04/10/JUC%E4%B9%8BForkJoin%E6%A1%86%E6%9E%B6/" title="JUC之ForkJoin框架"><img src="/img/2022-04-10/wallhaven-6ozg3x.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC之ForkJoin框架"/></a><div class="content"><a class="title" href="/2022/04/10/JUC%E4%B9%8BForkJoin%E6%A1%86%E6%9E%B6/" title="JUC之ForkJoin框架">JUC之ForkJoin框架</a><time datetime="2022-04-10T06:18:53.000Z" title="发表于 2022-04-10 14:18:53">2022-04-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By aYu</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(()=>{
  const $countDom = document.getElementById('twikoo-count')
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo-5ip6-k5d1623s2-1556872271-qqcom.vercel.app/',
      region: 'ap-xian'
    }, null))
  }

  const getCount = () => {
    twikoo.getCommentsCount({
      envId: 'https://twikoo-5ip6-k5d1623s2-1556872271-qqcom.vercel.app/',
      region: 'ap-xian',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      $countDom.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const loadTwikoo = (bool = false) => {
    if (typeof twikoo === 'object') {
      init()
      bool && $countDom && setTimeout(getCount,0)
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(()=> {
        init()
        bool && $countDom && setTimeout(getCount,0)
      })
    }
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo(true)
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --><script data-pjax>
  function butterfly_clock_injector_config(){
    var parent_div_git = document.getElementsByClassName('sticky_layout')[0];
    var item_html = '<div class="card-widget card-clock"><div class="card-glass"><div class="card-background"><div class="card-content"><div id="hexo_electric_clock"><img class="entered loading" id="card-clock-loading" src="/img/loading.gif" style="height: 120px; width: 100%;" data-ll-status="loading"/></div></div></div></div></div>';
    console.log('已挂载butterfly_clock')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'null'.split(',');
  var cpage = location.pathname;
  var epage = 'all';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_clock_injector_config();
  }
  else if (epage === cpage){
    butterfly_clock_injector_config();
  }
  </script><script src="https://pv.sohu.com/cityjson?ie=utf-8"></script><script data-pjax src="https://cdn.jsdelivr.net/npm/hexo-butterfly-clock/lib/clock.min.js"></script><!-- hexo injector body_end end --></body></html>